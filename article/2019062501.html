<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Hive常用函数的使用 | foochane</title><meta name="description" content="Hive常用函数的使用"><meta name="keywords" content="大数据,hive"><meta name="author" content="foochane"><meta name="copyright" content="foochane"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/images/site/favicon.png"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Hive常用函数的使用"><meta name="twitter:description" content="Hive常用函数的使用"><meta name="twitter:image" content="https://foochane.cn/images/cover/11.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Hive常用函数的使用"><meta property="og:url" content="https://foochane.cn/article/2019062501"><meta property="og:site_name" content="foochane"><meta property="og:description" content="Hive常用函数的使用"><meta property="og:image" content="https://foochane.cn/images/cover/11.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://foochane.cn/article/2019062501"><link rel="prev" title="zookeeper的安装和使用" href="https://foochane.cn/article/2019062601.html"><link rel="next" title="MySQL常用操作记录" href="https://foochane.cn/article/2019062401.html"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e75706f2332bc6bbea2cc9a3372553f0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="foochane" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">foochane</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/images/site/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">60</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">23</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-基本介绍"><span class="toc_mobile_items-text">1 基本介绍</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-1-HIVE简单介绍"><span class="toc_mobile_items-text">1.1 HIVE简单介绍</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-2-Hive的用途"><span class="toc_mobile_items-text">1.2 Hive的用途</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-使用方式"><span class="toc_mobile_items-text">2 使用方式</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-1-方式1：直接使用hive服务端"><span class="toc_mobile_items-text">2.1 方式1：直接使用hive服务端</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-2-方式2：使用beeline客户端"><span class="toc_mobile_items-text">2.2 方式2：使用beeline客户端</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#参数说明"><span class="toc_mobile_items-text">参数说明</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#报错"><span class="toc_mobile_items-text">报错</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#解决"><span class="toc_mobile_items-text">解决</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-3-方式3：使用hive命令运行sql"><span class="toc_mobile_items-text">2.3 方式3：使用hive命令运行sql</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-4-方式4：写脚本"><span class="toc_mobile_items-text">2.4 方式4：写脚本</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-表的基本操作"><span class="toc_mobile_items-text">3 表的基本操作</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-1-新建数据库"><span class="toc_mobile_items-text">3.1 新建数据库</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-2-删除数据库"><span class="toc_mobile_items-text">3.2 删除数据库</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-3-建内部表"><span class="toc_mobile_items-text">3.3 建内部表</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-4-建外部表"><span class="toc_mobile_items-text">3.4 建外部表</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-5-导入数据"><span class="toc_mobile_items-text">3.5 导入数据</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-6-建分区表"><span class="toc_mobile_items-text">3.6 建分区表</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-查询语法"><span class="toc_mobile_items-text">4 查询语法</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-1-条件查询"><span class="toc_mobile_items-text">4.1 条件查询</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-2-join关联查询"><span class="toc_mobile_items-text">4.2 join关联查询</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-3-内连接"><span class="toc_mobile_items-text">4.3 内连接</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-4-左外连接（左连接）"><span class="toc_mobile_items-text">4.4 左外连接（左连接）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-5-右外连接（右连接）"><span class="toc_mobile_items-text">4.5 右外连接（右连接）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-6-全外连接"><span class="toc_mobile_items-text">4.6 全外连接</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-7-左半连接"><span class="toc_mobile_items-text">4.7 左半连接</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-8-group-by分组聚合"><span class="toc_mobile_items-text">4.8 group by分组聚合</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#每一行的url变成大写"><span class="toc_mobile_items-text">每一行的url变成大写</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#求每条url的访问次数"><span class="toc_mobile_items-text">求每条url的访问次数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#求每个页面的访问者中ip最大的一个"><span class="toc_mobile_items-text">求每个页面的访问者中ip最大的一个</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#求每个用户访问同一个页面的所有记录中，时间最晚的一条"><span class="toc_mobile_items-text">求每个用户访问同一个页面的所有记录中，时间最晚的一条</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#求8月4号以后，每天http-www-xxx-cn-job的总访问次数，及访问者中ip地址中最大的"><span class="toc_mobile_items-text">求8月4号以后，每天http:&#x2F;&#x2F;www.xxx.cn&#x2F;job的总访问次数，及访问者中ip地址中最大的</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的"><span class="toc_mobile_items-text">求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的，且只查询出总访问次数-gt-2-的记录"><span class="toc_mobile_items-text">求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的，且只查询出总访问次数&gt;2 的记录</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-基本数据类型"><span class="toc_mobile_items-text">5 基本数据类型</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-1-数字类型"><span class="toc_mobile_items-text">5.1 数字类型</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-2-日期类型"><span class="toc_mobile_items-text">5.2 日期类型</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-3-字符串类型"><span class="toc_mobile_items-text">5.3 字符串类型</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-4-杂类型"><span class="toc_mobile_items-text">5.4 杂类型</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-5-复合类型"><span class="toc_mobile_items-text">5.5 复合类型</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#5-5-1-数组类型"><span class="toc_mobile_items-text">5.5.1 数组类型</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#array"><span class="toc_mobile_items-text">array[]</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#查询每部电影主演"><span class="toc_mobile_items-text">查询每部电影主演</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#array-contains"><span class="toc_mobile_items-text">array_contains</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#查询包含’吴京’的电影"><span class="toc_mobile_items-text">查询包含’吴京’的电影</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#size"><span class="toc_mobile_items-text">size</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#每部电影查询列出的演员数量"><span class="toc_mobile_items-text">每部电影查询列出的演员数量</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#5-5-2-map类型"><span class="toc_mobile_items-text">5.5.2 map类型</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#数据"><span class="toc_mobile_items-text">数据</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#查出每个人的-爸爸、姐妹"><span class="toc_mobile_items-text">查出每个人的 爸爸、姐妹</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#查出每个人有哪些亲属关系"><span class="toc_mobile_items-text">查出每个人有哪些亲属关系</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#查出每个人的亲人名字"><span class="toc_mobile_items-text">查出每个人的亲人名字</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#查出每个人的亲人数量"><span class="toc_mobile_items-text">查出每个人的亲人数量</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#查出所有拥有兄弟的人及他的兄弟是谁"><span class="toc_mobile_items-text">查出所有拥有兄弟的人及他的兄弟是谁</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#5-5-3-stuct类型"><span class="toc_mobile_items-text">5.5.3 stuct类型</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#查询每个人的id-name和地址"><span class="toc_mobile_items-text">查询每个人的id name和地址</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#6-常用内置函数"><span class="toc_mobile_items-text">6 常用内置函数</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#6-1-时间处理函数"><span class="toc_mobile_items-text">6.1 时间处理函数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#6-2-类型转换函数"><span class="toc_mobile_items-text">6.2 类型转换函数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#6-3-字符串截取和拼接"><span class="toc_mobile_items-text">6.3 字符串截取和拼接</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#6-4-Json数据解析函数"><span class="toc_mobile_items-text">6.4 Json数据解析函数</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#6-5-url解析函数"><span class="toc_mobile_items-text">6.5 url解析函数</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-自定义函数"><span class="toc_mobile_items-text">7 自定义函数</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#7-1-问题"><span class="toc_mobile_items-text">7.1 问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#7-2-实现步骤"><span class="toc_mobile_items-text">7.2 实现步骤</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-基本介绍"><span class="toc-text">1 基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-HIVE简单介绍"><span class="toc-text">1.1 HIVE简单介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Hive的用途"><span class="toc-text">1.2 Hive的用途</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-使用方式"><span class="toc-text">2 使用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-方式1：直接使用hive服务端"><span class="toc-text">2.1 方式1：直接使用hive服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-方式2：使用beeline客户端"><span class="toc-text">2.2 方式2：使用beeline客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#参数说明"><span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#报错"><span class="toc-text">报错</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#解决"><span class="toc-text">解决</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-方式3：使用hive命令运行sql"><span class="toc-text">2.3 方式3：使用hive命令运行sql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-方式4：写脚本"><span class="toc-text">2.4 方式4：写脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-表的基本操作"><span class="toc-text">3 表的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-新建数据库"><span class="toc-text">3.1 新建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-删除数据库"><span class="toc-text">3.2 删除数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-建内部表"><span class="toc-text">3.3 建内部表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-建外部表"><span class="toc-text">3.4 建外部表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-导入数据"><span class="toc-text">3.5 导入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-建分区表"><span class="toc-text">3.6 建分区表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-查询语法"><span class="toc-text">4 查询语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-条件查询"><span class="toc-text">4.1 条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-join关联查询"><span class="toc-text">4.2 join关联查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-内连接"><span class="toc-text">4.3 内连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-左外连接（左连接）"><span class="toc-text">4.4 左外连接（左连接）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-右外连接（右连接）"><span class="toc-text">4.5 右外连接（右连接）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-全外连接"><span class="toc-text">4.6 全外连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-左半连接"><span class="toc-text">4.7 左半连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-group-by分组聚合"><span class="toc-text">4.8 group by分组聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#每一行的url变成大写"><span class="toc-text">每一行的url变成大写</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#求每条url的访问次数"><span class="toc-text">求每条url的访问次数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#求每个页面的访问者中ip最大的一个"><span class="toc-text">求每个页面的访问者中ip最大的一个</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#求每个用户访问同一个页面的所有记录中，时间最晚的一条"><span class="toc-text">求每个用户访问同一个页面的所有记录中，时间最晚的一条</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#求8月4号以后，每天http-www-xxx-cn-job的总访问次数，及访问者中ip地址中最大的"><span class="toc-text">求8月4号以后，每天http:&#x2F;&#x2F;www.xxx.cn&#x2F;job的总访问次数，及访问者中ip地址中最大的</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的"><span class="toc-text">求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的，且只查询出总访问次数-gt-2-的记录"><span class="toc-text">求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的，且只查询出总访问次数&gt;2 的记录</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-基本数据类型"><span class="toc-text">5 基本数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-数字类型"><span class="toc-text">5.1 数字类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-日期类型"><span class="toc-text">5.2 日期类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-字符串类型"><span class="toc-text">5.3 字符串类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-杂类型"><span class="toc-text">5.4 杂类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-复合类型"><span class="toc-text">5.5 复合类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-1-数组类型"><span class="toc-text">5.5.1 数组类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#array"><span class="toc-text">array[]</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#查询每部电影主演"><span class="toc-text">查询每部电影主演</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#array-contains"><span class="toc-text">array_contains</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#查询包含’吴京’的电影"><span class="toc-text">查询包含’吴京’的电影</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#size"><span class="toc-text">size</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#每部电影查询列出的演员数量"><span class="toc-text">每部电影查询列出的演员数量</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-2-map类型"><span class="toc-text">5.5.2 map类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#数据"><span class="toc-text">数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#查出每个人的-爸爸、姐妹"><span class="toc-text">查出每个人的 爸爸、姐妹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#查出每个人有哪些亲属关系"><span class="toc-text">查出每个人有哪些亲属关系</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#查出每个人的亲人名字"><span class="toc-text">查出每个人的亲人名字</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#查出每个人的亲人数量"><span class="toc-text">查出每个人的亲人数量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#查出所有拥有兄弟的人及他的兄弟是谁"><span class="toc-text">查出所有拥有兄弟的人及他的兄弟是谁</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-3-stuct类型"><span class="toc-text">5.5.3 stuct类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#查询每个人的id-name和地址"><span class="toc-text">查询每个人的id name和地址</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-常用内置函数"><span class="toc-text">6 常用内置函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-时间处理函数"><span class="toc-text">6.1 时间处理函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-类型转换函数"><span class="toc-text">6.2 类型转换函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-字符串截取和拼接"><span class="toc-text">6.3 字符串截取和拼接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-Json数据解析函数"><span class="toc-text">6.4 Json数据解析函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-url解析函数"><span class="toc-text">6.5 url解析函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-自定义函数"><span class="toc-text">7 自定义函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-问题"><span class="toc-text">7.1 问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-实现步骤"><span class="toc-text">7.2 实现步骤</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/images/banner/0.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Hive常用函数的使用</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-06-25</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">6.3k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 33 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/article/2019062501.html#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/article/2019062501.html" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><!-- 
文章作者：[foochane](https://foochane.cn/) 
</br>
原文链接：[https://foochane.cn/article/2019062501.html](https://foochane.cn/article/2019062501.html)  
-->

<blockquote>
<p>Hive命令行 服务端 beeline  基本语法 HQL 函数使用</p>
</blockquote>
<h2 id="1-基本介绍"><a href="#1-基本介绍" class="headerlink" title="1 基本介绍"></a>1 基本介绍</h2><h3 id="1-1-HIVE简单介绍"><a href="#1-1-HIVE简单介绍" class="headerlink" title="1.1 HIVE简单介绍"></a>1.1 HIVE简单介绍</h3><p><code>Hive</code>是一个可以将<code>SQL</code>翻译为<code>MR</code>程序的工具，支持用户将<code>HDFS</code>上的文件映射为表结构，然后用户就可以输入<code>SQL</code>对这些表（<code>HDFS</code>上的文件）进行查询分析。<code>Hive</code>将用户定义的库、表结构等信息存储<code>hive</code>的元数据库（可以是本地<code>derby</code>，也可以是远程<code>mysql</code>）中。</p>
<h3 id="1-2-Hive的用途"><a href="#1-2-Hive的用途" class="headerlink" title="1.2 Hive的用途"></a>1.2 Hive的用途</h3><ul>
<li>做数据分析，不用自己写大量的<code>MR</code>程序，只需要写<code>SQL</code>脚本即可</li>
<li>用于构建大数据体系下的数据仓库</li>
</ul>
<p><strong><code>hive 2</code> 以后 把底层引擎从<code>MapReduce</code>换成了<code>Spark</code></strong></p>
<p>启动<code>hive</code>前要先启动<code>hdfs</code> 和<code>yarn</code></p>
<h2 id="2-使用方式"><a href="#2-使用方式" class="headerlink" title="2 使用方式"></a>2 使用方式</h2><h3 id="2-1-方式1：直接使用hive服务端"><a href="#2-1-方式1：直接使用hive服务端" class="headerlink" title="2.1 方式1：直接使用hive服务端"></a>2.1 方式1：直接使用hive服务端</h3><p>输入命令 <code>$ hive</code>即可：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hadoop@Master:~$ hive</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/usr/local/bigdata/hive-2.3.5/lib/log4j-slf4j-impl-2.6.2.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/usr/local/bigdata/hadoop-2.7.1/share/hadoop/common/lib/slf4j-log4j12-1.7.10.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html<span class="comment">#multiple_bindings for an explanation.</span></span><br><span class="line">SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br><span class="line"></span><br><span class="line">Logging initialized using configuration in file:/usr/local/bigdata/hive-2.3.5/conf/hive-log4j2.properties Async: true</span><br><span class="line">Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">hive&gt;show databases;</span><br><span class="line">OK</span><br><span class="line">dbtest</span><br><span class="line">default</span><br><span class="line">Time taken: 3.539 seconds, Fetched: 2 row(s)</span><br><span class="line">hive&gt;</span><br></pre></td></tr></table></figure></div>

<p>技巧：<br>让提示符显示当前库：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;set hive.cli.print.current.db=true;</span><br></pre></td></tr></table></figure></div>

<p>显示查询结果是显示自带名称：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;set hive.cli.print.header=true;</span><br></pre></td></tr></table></figure></div>

<p>这样设置只是对当前窗口有效，永久生效可以在当前用户目录下建一个<code>.hiverc</code>文件。<br>加入如下内容：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.cli.print.current.db=<span class="literal">true</span>;</span><br><span class="line"><span class="keyword">set</span> hive.cli.print.header=<span class="literal">true</span>;</span><br></pre></td></tr></table></figure></div>



<h3 id="2-2-方式2：使用beeline客户端"><a href="#2-2-方式2：使用beeline客户端" class="headerlink" title="2.2 方式2：使用beeline客户端"></a>2.2 方式2：使用beeline客户端</h3><p>将hive启动为一个服务端，然后可以在任意一台机器上使用beeline客户端连接hive服务，进行交互式查询</p>
<p>hive是一个单机的服务端可以在任何一台机器里安装，它访问的是hdfs集群。</p>
<p>启动hive服务 ：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ nohup hiveserver2 1&gt;/dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure></div>

<p>启动后，可以用beeline去连接，beeline是一个客户端，可以在任意机器启动,只要能够跟hive服务端相连即可。</p>
<p>在本地启动beeline</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ beeline -u jdbc:hive2://localhost:10000 -n hadoop -p hadoop</span><br></pre></td></tr></table></figure></div>

<p>在启动机器上启动beeline</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ beeline -u jdbc:hive2://Master:10000 -n hadoop -p hadoop</span><br></pre></td></tr></table></figure></div>

<p>注意：要打开metastore的服务端：hive –service metastore</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ nohup hive --service metastore 1&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hadoop@Master:~$ beeline -u jdbc:hive2://Master:10000 -n hadoop -p hadoop</span><br><span class="line">Connecting to jdbc:hive2://Master:10000</span><br><span class="line">19/06/25 01:50:12 INFO jdbc.Utils: Supplied authorities: Master:10000</span><br><span class="line">19/06/25 01:50:12 INFO jdbc.Utils: Resolved authority: Master:10000</span><br><span class="line">19/06/25 01:50:13 INFO jdbc.HiveConnection: Will try to open client transport with JDBC Uri: jdbc:hive2://Master:10000</span><br><span class="line">Connected to: Apache Hive (version 2.3.5)</span><br><span class="line">Driver: Hive JDBC (version 1.2.1.spark2)</span><br><span class="line">Transaction isolation: TRANSACTION_REPEATABLE_READ</span><br><span class="line">Beeline version 1.2.1.spark2 by Apache Hive</span><br><span class="line">0: jdbc:hive2://Master:10000&gt;</span><br></pre></td></tr></table></figure></div>
<h5 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h5><ul>
<li>u ：指定连接方式</li>
<li>n ：登录的用户（系统用户）</li>
<li>p ：用户密码</li>
</ul>
<h5 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">errorMessage:Failed to open new session: java.lang.RuntimeException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.authorize.AuthorizationException): User: hadoop is not allowed to impersonate hadoop), serverProtocolVersion:null)</span><br></pre></td></tr></table></figure></div>

<h5 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h5><p>在 hadoop配置文件中的core-site.xml 文件中添加如下内容,然后重启hadoop集群：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.hadoop.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>Allow the superuser oozie to impersonate any members of the group group1 and group2<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.hadoop.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>Master,127.0.0.1,localhost<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">description</span>&gt;</span>The superuser can connect only from host1 and host2 to impersonate a user<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>


<h3 id="2-3-方式3：使用hive命令运行sql"><a href="#2-3-方式3：使用hive命令运行sql" class="headerlink" title="2.3 方式3：使用hive命令运行sql"></a>2.3 方式3：使用hive命令运行sql</h3><p>接用 <code>hive -e</code> 在命令行中运行<code>sql</code>命令，该命令可以一起运行多条<code>sql</code>语句，用<code>;</code>隔开。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive -e "sql1;sql2;sql3;sql4"</span><br></pre></td></tr></table></figure></div>

<p>另外，还可以使用 <code>hive -f</code>命令。</p>
<p>事先将sql语句写入一个文件比如 <code>q.hql</code>，然后用<code>hive -f</code>命令执行：　
　</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive -f q.hql</span><br></pre></td></tr></table></figure></div>

<h3 id="2-4-方式4：写脚本"><a href="#2-4-方式4：写脚本" class="headerlink" title="2.4 方式4：写脚本"></a>2.4 方式4：写脚本</h3><p>可以将<code>方式3</code>写入一个<code>xxx.sh</code>脚本中,然后运行该脚本。</p>
<h2 id="3-表的基本操作"><a href="#3-表的基本操作" class="headerlink" title="3 表的基本操作"></a>3 表的基本操作</h2><h3 id="3-1-新建数据库"><a href="#3-1-新建数据库" class="headerlink" title="3.1 新建数据库"></a>3.1 新建数据库</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> db1;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; create database db1;</span><br><span class="line">No rows affected (1.123 seconds)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; show databases;</span><br><span class="line">+<span class="comment">----------------+--+</span></span><br><span class="line">| database_name  |</span><br><span class="line">+<span class="comment">----------------+--+</span></span><br><span class="line">| db1            |</span><br><span class="line">| dbtest         |</span><br><span class="line">| default        |</span><br><span class="line">+<span class="comment">----------------+--+</span></span><br></pre></td></tr></table></figure></div>

<p>成功后，hive就会在<code>/user/hive/warehouse/</code>下建一个文件夹： <code>db1.db</code></p>
<h3 id="3-2-删除数据库"><a href="#3-2-删除数据库" class="headerlink" title="3.2 删除数据库"></a>3.2 删除数据库</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> db1;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; drop database db1;</span><br><span class="line">No rows affected (0.969 seconds)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; show databases;</span><br><span class="line">+<span class="comment">----------------+--+</span></span><br><span class="line">| database_name  |</span><br><span class="line">+<span class="comment">----------------+--+</span></span><br><span class="line">| dbtest         |</span><br><span class="line">| default        |</span><br><span class="line">+<span class="comment">----------------+--+</span></span><br></pre></td></tr></table></figure></div>

<h3 id="3-3-建内部表"><a href="#3-3-建内部表" class="headerlink" title="3.3 建内部表"></a>3.3 建内部表</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> db1;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_test(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="keyword">string</span>,age <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span></span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; use db1;</span><br><span class="line">No rows affected (0.293 seconds)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; create table t_test(id int,name string,age int)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; row format delimited</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; fields terminated by ',';</span><br><span class="line">No rows affected (1.894 seconds)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; desc db1.t_test;</span><br><span class="line">+<span class="comment">-----------+------------+----------+--+</span></span><br><span class="line">| col_name  | data_type  | <span class="keyword">comment</span>  |</span><br><span class="line">+<span class="comment">-----------+------------+----------+--+</span></span><br><span class="line">| <span class="keyword">id</span>        | <span class="built_in">int</span>        |          |</span><br><span class="line">| <span class="keyword">name</span>      | <span class="keyword">string</span>     |          |</span><br><span class="line">| age       | <span class="built_in">int</span>        |          |</span><br><span class="line">+<span class="comment">-----------+------------+----------+--+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> selected (<span class="number">0.697</span> <span class="keyword">seconds</span>)</span><br></pre></td></tr></table></figure></div>

<p>建表后，hive会在仓库目录中建一个表目录：  /user/hive/warehouse/db1.db/t_test</p>
<h3 id="3-4-建外部表"><a href="#3-4-建外部表" class="headerlink" title="3.4 建外部表"></a>3.4 建外部表</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> t_test1(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="keyword">string</span>,age <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span></span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">location <span class="string">'/user/hive/external/t_test1'</span>;</span><br></pre></td></tr></table></figure></div>

<p>这里的<code>location</code>指的是<code>hdfs</code>上的目录，可以直接在该目录下放入相应格式的文件，就可以在<code>hive</code>表中查看到。</p>
<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; create external table t_test1(id int,name string,age int)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; row format delimited</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; fields terminated by ','</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; location '/user/hive/external/t_test1';</span><br><span class="line">No rows affected (0.7 seconds)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; desc db1.t_test1;</span><br><span class="line">+<span class="comment">-----------+------------+----------+--+</span></span><br><span class="line">| col_name  | data_type  | <span class="keyword">comment</span>  |</span><br><span class="line">+<span class="comment">-----------+------------+----------+--+</span></span><br><span class="line">| <span class="keyword">id</span>        | <span class="built_in">int</span>        |          |</span><br><span class="line">| <span class="keyword">name</span>      | <span class="keyword">string</span>     |          |</span><br><span class="line">| age       | <span class="built_in">int</span>        |          |</span><br><span class="line">+<span class="comment">-----------+------------+----------+--+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> selected (<span class="number">0.395</span> <span class="keyword">seconds</span>)</span><br></pre></td></tr></table></figure></div>

<p>本地创建测试文件<code>user.data</code></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1,xiaowang,28</span><br><span class="line">2,xiaoli,18</span><br><span class="line">3,xiaohong,23</span><br></pre></td></tr></table></figure></div>

<p>放入hdfs中：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -mkdir -p /user/hive/external/t_test1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hdfs dfs -put ./user.data /user/hive/external/t_test1</span></span><br></pre></td></tr></table></figure></div>

<p>此时在hive表中就可以查看到数据：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select * from db1.t_test1;</span><br><span class="line">+<span class="comment">-------------+---------------+--------------+--+</span></span><br><span class="line">| t_test1.id  | t_test1.name  | t_test1.age  |</span><br><span class="line">+<span class="comment">-------------+---------------+--------------+--+</span></span><br><span class="line">| 1           | xiaowang      | 28           |</span><br><span class="line">| 2           | xiaoli        | 18           |</span><br><span class="line">| 3           | xiaohong      | 23           |</span><br><span class="line">+<span class="comment">-------------+---------------+--------------+--+</span></span><br><span class="line">3 rows selected (8 seconds)</span><br></pre></td></tr></table></figure></div>

<p><strong>注意：如果删除外部表，hdfs里的文件并不会删除</strong></p>
<p>也就是如果包<code>db1.t_test1</code>删除，hdfs下<code>/user/hive/external/t_test1/user.data</code>文件并不会被删除。</p>
<h3 id="3-5-导入数据"><a href="#3-5-导入数据" class="headerlink" title="3.5 导入数据"></a>3.5 导入数据</h3><p>本质上就是把数据文件放入表目录；</p>
<p>可以用hive命令来做：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> [<span class="keyword">local</span>] inpath <span class="string">'/data/path'</span> [overwrite] <span class="keyword">into</span> <span class="keyword">table</span> t_test;</span><br></pre></td></tr></table></figure></div>

<p>加<code>local</code>代表导入本地数据。</p>
<p>导入本地数据</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/user.data'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_test;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; load data local inpath '/home/hadoop/user.data' into table t_test;</span><br><span class="line">No rows affected (2.06 seconds)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; select * from db1.t_test;</span><br><span class="line">+<span class="comment">------------+--------------+-------------+--+</span></span><br><span class="line">| t_test.id  | t_test.name  | t_test.age  |</span><br><span class="line">+<span class="comment">------------+--------------+-------------+--+</span></span><br><span class="line">| 1          | xiaowang     | 28          |</span><br><span class="line">| 2          | xiaoli       | 18          |</span><br><span class="line">| 3          | xiaohong     | 23          |</span><br><span class="line">+<span class="comment">------------+--------------+-------------+--+</span></span><br></pre></td></tr></table></figure></div>
<p>导入hdfs中的数据</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> inpath <span class="string">'/user/hive/external/t_test1/user.data'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_test;</span><br></pre></td></tr></table></figure></div>
<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; load data inpath '/user/hive/external/t_test1/user.data' into table t_test;</span><br><span class="line">No rows affected (1.399 seconds)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; select * from db1.t_test;</span><br><span class="line">+<span class="comment">------------+--------------+-------------+--+</span></span><br><span class="line">| t_test.id  | t_test.name  | t_test.age  |</span><br><span class="line">+<span class="comment">------------+--------------+-------------+--+</span></span><br><span class="line">| 1          | xiaowang     | 28          |</span><br><span class="line">| 2          | xiaoli       | 18          |</span><br><span class="line">| 3          | xiaohong     | 23          |</span><br><span class="line">| 1          | xiaowang     | 28          |</span><br><span class="line">| 2          | xiaoli       | 18          |</span><br><span class="line">| 3          | xiaohong     | 23          |</span><br><span class="line">+<span class="comment">------------+--------------+-------------+--+</span></span><br><span class="line">6 rows selected (0.554 seconds)</span><br></pre></td></tr></table></figure></div>

<p><strong>注意：从本地导入数据，本地数据不是发生变化，从hdfs中导入数据，hdfs中的导入的文件会被移动到数据仓库相应的目录下</strong></p>
<h3 id="3-6-建分区表"><a href="#3-6-建分区表" class="headerlink" title="3.6 建分区表"></a>3.6 建分区表</h3><p>分区的意义在于可以将数据分子目录存储，以便于查询时让数据读取范围更精准</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_test1(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="keyword">string</span>,age <span class="built_in">int</span>,create_time <span class="built_in">bigint</span>)</span><br><span class="line">partitioned <span class="keyword">by</span> (<span class="keyword">day</span> <span class="keyword">string</span>,country <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span></span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure></div>

<p>插入数据到指定分区：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; load data [local] inpath '/data/path1' [overwrite] into table t_test partition(day='2019-06-04',country='China');</span><br><span class="line">&gt; load data [local] inpath '/data/path2' [overwrite] into table t_test partition(day='2019-06-05',country='China');</span><br><span class="line">&gt; load data [local] inpath '/data/path3' [overwrite] into table t_test partition(day='2019-06-04',country='England');</span><br></pre></td></tr></table></figure></div>
<p>导入完成后，形成的目录结构如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/user/hive/warehouse/db1.db/t_test1/day=2019-06-04/country=China/...</span><br><span class="line">/user/hive/warehouse/db1.db/t_test1/day=2019-06-04/country=England/...</span><br><span class="line">/user/hive/warehouse/db1.db/t_test1/day=2019-06-05/country=China/...</span><br></pre></td></tr></table></figure></div>

<h2 id="4-查询语法"><a href="#4-查询语法" class="headerlink" title="4 查询语法"></a>4 查询语法</h2><h3 id="4-1-条件查询"><a href="#4-1-条件查询" class="headerlink" title="4.1 条件查询"></a>4.1 条件查询</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_table <span class="keyword">where</span> a&lt;<span class="number">1000</span> <span class="keyword">and</span> b&gt;<span class="number">0</span>;</span><br></pre></td></tr></table></figure></div>


<h3 id="4-2-join关联查询"><a href="#4-2-join关联查询" class="headerlink" title="4.2 join关联查询"></a>4.2 join关联查询</h3><p>各类join</p>
<p>测试数据：<br>a.txt：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a,1</span><br><span class="line">b,2</span><br><span class="line">c,3</span><br><span class="line">d,4</span><br></pre></td></tr></table></figure></div>

<p>b.txt:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b,16</span><br><span class="line">c,17</span><br><span class="line">d,18</span><br><span class="line">e,19</span><br></pre></td></tr></table></figure></div>

<p>建表导入数据：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_a(<span class="keyword">name</span> <span class="keyword">string</span>,<span class="keyword">num</span> <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span></span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_b(<span class="keyword">name</span> <span class="keyword">string</span>,age <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span></span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/a.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_a;</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/b.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_b;</span><br></pre></td></tr></table></figure></div>

<p>表数据如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select * from t_a;</span><br><span class="line">+<span class="comment">-----------+----------+--+</span></span><br><span class="line">| t_a.name  | t_a.num  |</span><br><span class="line">+<span class="comment">-----------+----------+--+</span></span><br><span class="line">| a         | 1        |</span><br><span class="line">| b         | 2        |</span><br><span class="line">| c         | 3        |</span><br><span class="line">| d         | 4        |</span><br><span class="line">+<span class="comment">-----------+----------+--+</span></span><br><span class="line">4 rows selected (0.523 seconds)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; select * from t_b;</span><br><span class="line">+<span class="comment">-----------+----------+--+</span></span><br><span class="line">| t_b.name  | t_b.age  |</span><br><span class="line">+<span class="comment">-----------+----------+--+</span></span><br><span class="line">| b         | 16       |</span><br><span class="line">| c         | 17       |</span><br><span class="line">| d         | 18       |</span><br><span class="line">| e         | 19       |</span><br><span class="line">+<span class="comment">-----------+----------+--+</span></span><br><span class="line"></span><br><span class="line">4 rows selected (0.482 seconds)</span><br></pre></td></tr></table></figure></div>

<h3 id="4-3-内连接"><a href="#4-3-内连接" class="headerlink" title="4.3 内连接"></a>4.3 内连接</h3><p>指定join条件</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.*,b.*</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">t_a a <span class="keyword">join</span> t_b b <span class="keyword">on</span> a.name=b.name;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select a.*,b.*</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; t_a a join t_b b on a.name=b.name;</span><br><span class="line">....</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br><span class="line">| a.name  | a.num  | b.name  | b.age  |</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br><span class="line">| b       | 2      | b       | 16     |</span><br><span class="line">| c       | 3      | c       | 17     |</span><br><span class="line">| d       | 4      | d       | 18     |</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br></pre></td></tr></table></figure></div>


<h3 id="4-4-左外连接（左连接）"><a href="#4-4-左外连接（左连接）" class="headerlink" title="4.4 左外连接（左连接）"></a>4.4 左外连接（左连接）</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.*,b.*</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">t_a a <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> t_b b <span class="keyword">on</span> a.name=b.name;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select a.*,b.*</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; t_a a left outer join t_b b on a.name=b.name;</span><br><span class="line">...</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br><span class="line">| a.name  | a.num  | b.name  | b.age  |</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br><span class="line">| a       | 1      | NULL    | NULL   |</span><br><span class="line">| b       | 2      | b       | 16     |</span><br><span class="line">| c       | 3      | c       | 17     |</span><br><span class="line">| d       | 4      | d       | 18     |</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br></pre></td></tr></table></figure></div>


<h3 id="4-5-右外连接（右连接）"><a href="#4-5-右外连接（右连接）" class="headerlink" title="4.5 右外连接（右连接）"></a>4.5 右外连接（右连接）</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.*,b.*</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">t_a a <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> t_b b <span class="keyword">on</span> a.name=b.name;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select a.*,b.*</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; t_a a right outer join t_b b on a.name=b.name;</span><br><span class="line">....</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br><span class="line">| a.name  | a.num  | b.name  | b.age  |</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br><span class="line">| b       | 2      | b       | 16     |</span><br><span class="line">| c       | 3      | c       | 17     |</span><br><span class="line">| d       | 4      | d       | 18     |</span><br><span class="line">| NULL    | NULL   | e       | 19     |</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br></pre></td></tr></table></figure></div>


<h3 id="4-6-全外连接"><a href="#4-6-全外连接" class="headerlink" title="4.6 全外连接"></a>4.6 全外连接</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.*,b.*</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">t_a a <span class="keyword">full</span> <span class="keyword">outer</span> <span class="keyword">join</span> t_b b <span class="keyword">on</span> a.name=b.name;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select a.*,b.*</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; t_a a full outer join t_b b on a.name=b.name;</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br><span class="line">| a.name  | a.num  | b.name  | b.age  |</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br><span class="line">| a       | 1      | NULL    | NULL   |</span><br><span class="line">| b       | 2      | b       | 16     |</span><br><span class="line">| c       | 3      | c       | 17     |</span><br><span class="line">| d       | 4      | d       | 18     |</span><br><span class="line">| NULL    | NULL   | e       | 19     |</span><br><span class="line">+<span class="comment">---------+--------+---------+--------+--+</span></span><br></pre></td></tr></table></figure></div>


<h3 id="4-7-左半连接"><a href="#4-7-左半连接" class="headerlink" title="4.7 左半连接"></a>4.7 左半连接</h3><p>求存在于a表，且b表里也存在的数据。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.*</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">t_a a <span class="keyword">left</span> <span class="keyword">semi</span> <span class="keyword">join</span> t_b b <span class="keyword">on</span> a.name=b.name;</span><br></pre></td></tr></table></figure></div>

<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select a.*</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; t_a a left semi join t_b b on a.name=b.name;</span><br><span class="line">.....</span><br><span class="line">+<span class="comment">---------+--------+--+</span></span><br><span class="line">| a.name  | a.num  |</span><br><span class="line">+<span class="comment">---------+--------+--+</span></span><br><span class="line">| b       | 2      |</span><br><span class="line">| c       | 3      |</span><br><span class="line">| d       | 4      |</span><br><span class="line">+<span class="comment">---------+--------+--+</span></span><br></pre></td></tr></table></figure></div>

<h3 id="4-8-group-by分组聚合"><a href="#4-8-group-by分组聚合" class="headerlink" title="4.8 group by分组聚合"></a>4.8 group by分组聚合</h3><p>构建测试数据</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">192.168.33.3,http://www.xxx.cn/stu,2019-08-04 15:30:20</span><br><span class="line">192.168.33.3,http://www.xxx.cn/teach,2019-08-04 15:35:20</span><br><span class="line">192.168.33.4,http://www.xxx.cn/stu,2019-08-04 15:30:20</span><br><span class="line">192.168.33.4,http://www.xxx.cn/job,2019-08-04 16:30:20</span><br><span class="line"></span><br><span class="line">192.168.33.5,http://www.xxx.cn/job,2019-08-04 15:40:20</span><br><span class="line">192.168.33.3,http://www.xxx.cn/stu,2019-08-05 15:30:20</span><br><span class="line">192.168.44.3,http://www.xxx.cn/teach,2019-08-05 15:35:20</span><br><span class="line">192.168.33.44,http://www.xxx.cn/stu,2019-08-05 15:30:20</span><br><span class="line">192.168.33.46,http://www.xxx.cn/job,2019-08-05 16:30:20</span><br><span class="line"></span><br><span class="line">192.168.33.55,http://www.xxx.cn/job,2019-08-05 15:40:20</span><br><span class="line">192.168.133.3,http://www.xxx.cn/register,2019-08-06 15:30:20</span><br><span class="line">192.168.111.3,http://www.xxx.cn/register,2019-08-06 15:35:20</span><br><span class="line">192.168.34.44,http://www.xxx.cn/pay,2019-08-06 15:30:20</span><br><span class="line">192.168.33.46,http://www.xxx.cn/excersize,2019-08-06 16:30:20</span><br><span class="line">192.168.33.55,http://www.xxx.cn/job,2019-08-06 15:40:20</span><br><span class="line">192.168.33.46,http://www.xxx.cn/excersize,2019-08-06 16:30:20</span><br><span class="line">192.168.33.25,http://www.xxx.cn/job,2019-08-06 15:40:20</span><br><span class="line">192.168.33.36,http://www.xxx.cn/excersize,2019-08-06 16:30:20</span><br><span class="line">192.168.33.55,http://www.xxx.cn/job,2019-08-06 15:40:20</span><br></pre></td></tr></table></figure></div>

<p>建分区表，导入数据：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_pv(ip <span class="keyword">string</span>,<span class="keyword">url</span> <span class="keyword">string</span>,<span class="built_in">time</span> <span class="keyword">string</span>)</span><br><span class="line">partitioned <span class="keyword">by</span> (dt <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> </span><br><span class="line"><span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/pv.log.0804'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_pv <span class="keyword">partition</span>(dt=<span class="string">'2019-08-04'</span>);</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/pv.log.0805'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_pv <span class="keyword">partition</span>(dt=<span class="string">'2019-08-05'</span>);</span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/pv.log.0806'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_pv <span class="keyword">partition</span>(dt=<span class="string">'2019-08-06'</span>);</span><br></pre></td></tr></table></figure></div>

<p>查看数据：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select * from t_pv;</span><br><span class="line">+<span class="comment">----------------+------------------------------+----------------------+-------------+--+</span></span><br><span class="line">|    t_pv.ip     |           t_pv.url           |      t_pv.time       |   t_pv.dt   |</span><br><span class="line">+<span class="comment">----------------+------------------------------+----------------------+-------------+--+</span></span><br><span class="line">| 192.168.33.3   | http://www.xxx.cn/stu        | 2019-08-04 15:30:20  | 2019-08-04  |</span><br><span class="line">| 192.168.33.3   | http://www.xxx.cn/teach      | 2019-08-04 15:35:20  | 2019-08-04  |</span><br><span class="line">| 192.168.33.4   | http://www.xxx.cn/stu        | 2019-08-04 15:30:20  | 2019-08-04  |</span><br><span class="line">| 192.168.33.4   | http://www.xxx.cn/job        | 2019-08-04 16:30:20  | 2019-08-04  |</span><br><span class="line">| 192.168.33.5   | http://www.xxx.cn/job        | 2019-08-04 15:40:20  | 2019-08-05  |</span><br><span class="line">| 192.168.33.3   | http://www.xxx.cn/stu        | 2019-08-05 15:30:20  | 2019-08-05  |</span><br><span class="line">| 192.168.44.3   | http://www.xxx.cn/teach      | 2019-08-05 15:35:20  | 2019-08-05  |</span><br><span class="line">| 192.168.33.44  | http://www.xxx.cn/stu        | 2019-08-05 15:30:20  | 2019-08-05  |</span><br><span class="line">| 192.168.33.46  | http://www.xxx.cn/job        | 2019-08-05 16:30:20  | 2019-08-05  |</span><br><span class="line">| 192.168.33.55  | http://www.xxx.cn/job        | 2019-08-05 15:40:20  | 2019-08-06  |</span><br><span class="line">| 192.168.133.3  | http://www.xxx.cn/register   | 2019-08-06 15:30:20  | 2019-08-06  |</span><br><span class="line">| 192.168.111.3  | http://www.xxx.cn/register   | 2019-08-06 15:35:20  | 2019-08-06  |</span><br><span class="line">| 192.168.34.44  | http://www.xxx.cn/pay        | 2019-08-06 15:30:20  | 2019-08-06  |</span><br><span class="line">| 192.168.33.46  | http://www.xxx.cn/excersize  | 2019-08-06 16:30:20  | 2019-08-06  |</span><br><span class="line">| 192.168.33.55  | http://www.xxx.cn/job        | 2019-08-06 15:40:20  | 2019-08-06  |</span><br><span class="line">| 192.168.33.46  | http://www.xxx.cn/excersize  | 2019-08-06 16:30:20  | 2019-08-06  |</span><br><span class="line">| 192.168.33.25  | http://www.xxx.cn/job        | 2019-08-06 15:40:20  | 2019-08-06  |</span><br><span class="line">| 192.168.33.36  | http://www.xxx.cn/excersize  | 2019-08-06 16:30:20  | 2019-08-06  |</span><br><span class="line">| 192.168.33.55  | http://www.xxx.cn/job        | 2019-08-06 15:40:20  | 2019-08-06  |</span><br><span class="line">+<span class="comment">----------------+------------------------------+----------------------+-------------+--+</span></span><br></pre></td></tr></table></figure></div>

<p>查看表分区：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">partitions</span> t_pv;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; show partitions t_pv;</span><br><span class="line">+<span class="comment">----------------+--+</span></span><br><span class="line">|   partition    |</span><br><span class="line">+<span class="comment">----------------+--+</span></span><br><span class="line">| dt=2019-08-04  |</span><br><span class="line">| dt=2019-08-05  |</span><br><span class="line">| dt=2019-08-06  |</span><br><span class="line">+<span class="comment">----------------+--+</span></span><br><span class="line">3 rows selected (0.575 seconds)</span><br></pre></td></tr></table></figure></div>

<h5 id="每一行的url变成大写"><a href="#每一行的url变成大写" class="headerlink" title="每一行的url变成大写"></a>每一行的url变成大写</h5><ul>
<li>针对每一行进行运算</li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ip,<span class="keyword">upper</span>(<span class="keyword">url</span>),<span class="built_in">time</span></span><br><span class="line"><span class="keyword">from</span> t_pv</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select ip,upper(url),time</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from t_pv</span><br><span class="line">+<span class="comment">----------------+------------------------------+----------------------+--+</span></span><br><span class="line">|       ip       |             _c1              |         time         |</span><br><span class="line">+<span class="comment">----------------+------------------------------+----------------------+--+</span></span><br><span class="line">| 192.168.33.3   | HTTP://WWW.XXX.CN/STU        | 2019-08-04 15:30:20  |</span><br><span class="line">| 192.168.33.3   | HTTP://WWW.XXX.CN/TEACH      | 2019-08-04 15:35:20  |</span><br><span class="line">| 192.168.33.4   | HTTP://WWW.XXX.CN/STU        | 2019-08-04 15:30:20  |</span><br><span class="line">| 192.168.33.4   | HTTP://WWW.XXX.CN/JOB        | 2019-08-04 16:30:20  |</span><br><span class="line">| 192.168.33.5   | HTTP://WWW.XXX.CN/JOB        | 2019-08-04 15:40:20  |</span><br><span class="line">| 192.168.33.3   | HTTP://WWW.XXX.CN/STU        | 2019-08-05 15:30:20  |</span><br><span class="line">| 192.168.44.3   | HTTP://WWW.XXX.CN/TEACH      | 2019-08-05 15:35:20  |</span><br><span class="line">| 192.168.33.44  | HTTP://WWW.XXX.CN/STU        | 2019-08-05 15:30:20  |</span><br><span class="line">| 192.168.33.46  | HTTP://WWW.XXX.CN/JOB        | 2019-08-05 16:30:20  |</span><br><span class="line">| 192.168.33.55  | HTTP://WWW.XXX.CN/JOB        | 2019-08-05 15:40:20  |</span><br><span class="line">| 192.168.133.3  | HTTP://WWW.XXX.CN/REGISTER   | 2019-08-06 15:30:20  |</span><br><span class="line">| 192.168.111.3  | HTTP://WWW.XXX.CN/REGISTER   | 2019-08-06 15:35:20  |</span><br><span class="line">| 192.168.34.44  | HTTP://WWW.XXX.CN/PAY        | 2019-08-06 15:30:20  |</span><br><span class="line">| 192.168.33.46  | HTTP://WWW.XXX.CN/EXCERSIZE  | 2019-08-06 16:30:20  |</span><br><span class="line">| 192.168.33.55  | HTTP://WWW.XXX.CN/JOB        | 2019-08-06 15:40:20  |</span><br><span class="line">| 192.168.33.46  | HTTP://WWW.XXX.CN/EXCERSIZE  | 2019-08-06 16:30:20  |</span><br><span class="line">| 192.168.33.25  | HTTP://WWW.XXX.CN/JOB        | 2019-08-06 15:40:20  |</span><br><span class="line">| 192.168.33.36  | HTTP://WWW.XXX.CN/EXCERSIZE  | 2019-08-06 16:30:20  |</span><br><span class="line">| 192.168.33.55  | HTTP://WWW.XXX.CN/JOB        | 2019-08-06 15:40:20  |</span><br><span class="line">+<span class="comment">----------------+------------------------------+----------------------+--+</span></span><br></pre></td></tr></table></figure></div>


<h5 id="求每条url的访问次数"><a href="#求每条url的访问次数" class="headerlink" title="求每条url的访问次数"></a>求每条url的访问次数</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">url</span> ,<span class="keyword">count</span>(<span class="number">1</span>) <span class="comment">--对分好组的数据进行逐行运算</span></span><br><span class="line"><span class="keyword">from</span> t_pv</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">url</span>;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select url ,count(1)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from t_pv</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; group by url;</span><br><span class="line">·····</span><br><span class="line">+<span class="comment">------------------------------+------+--+</span></span><br><span class="line">|             url              | _c1  |</span><br><span class="line">+<span class="comment">------------------------------+------+--+</span></span><br><span class="line">| http://www.xxx.cn/excersize  | 3    |</span><br><span class="line">| http://www.xxx.cn/job        | 7    |</span><br><span class="line">| http://www.xxx.cn/pay        | 1    |</span><br><span class="line">| http://www.xxx.cn/register   | 2    |</span><br><span class="line">| http://www.xxx.cn/stu        | 4    |</span><br><span class="line">| http://www.xxx.cn/teach      | 2    |</span><br><span class="line">+<span class="comment">------------------------------+------+--+</span></span><br></pre></td></tr></table></figure></div>

<p>可以给_c1加入字段名称：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">url</span> ,<span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">as</span> <span class="keyword">count</span></span><br><span class="line"><span class="keyword">from</span> t_pv</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">url</span>;</span><br></pre></td></tr></table></figure></div>


<h5 id="求每个页面的访问者中ip最大的一个"><a href="#求每个页面的访问者中ip最大的一个" class="headerlink" title="求每个页面的访问者中ip最大的一个"></a>求每个页面的访问者中ip最大的一个</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">url</span>,<span class="keyword">max</span>(ip)</span><br><span class="line"><span class="keyword">from</span> t_pv</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">url</span>;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select url,max(ip)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from t_pv</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; group by url;</span><br><span class="line">WARNING: Hive-on-MR is deprecated in Hive 2 and may not be available in the future versions. Consider using a different execution engine (i.e. spark, tez) or using Hive 1.X releases.</span><br><span class="line">+<span class="comment">------------------------------+----------------+--+</span></span><br><span class="line">|             url              |      _c1       |</span><br><span class="line">+<span class="comment">------------------------------+----------------+--+</span></span><br><span class="line">| http://www.xxx.cn/excersize  | 192.168.33.46  |</span><br><span class="line">| http://www.xxx.cn/job        | 192.168.33.55  |</span><br><span class="line">| http://www.xxx.cn/pay        | 192.168.34.44  |</span><br><span class="line">| http://www.xxx.cn/register   | 192.168.133.3  |</span><br><span class="line">| http://www.xxx.cn/stu        | 192.168.33.44  |</span><br><span class="line">| http://www.xxx.cn/teach      | 192.168.44.3   |</span><br><span class="line">+<span class="comment">------------------------------+----------------+--+</span></span><br></pre></td></tr></table></figure></div>


<h5 id="求每个用户访问同一个页面的所有记录中，时间最晚的一条"><a href="#求每个用户访问同一个页面的所有记录中，时间最晚的一条" class="headerlink" title="求每个用户访问同一个页面的所有记录中，时间最晚的一条"></a>求每个用户访问同一个页面的所有记录中，时间最晚的一条</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ip,<span class="keyword">url</span>,<span class="keyword">max</span>(<span class="built_in">time</span>)</span><br><span class="line"><span class="keyword">from</span> t_pv</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> ip,<span class="keyword">url</span>;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select ip,url,max(time)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from t_pv</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; group by ip,url;</span><br><span class="line">.....</span><br><span class="line">+<span class="comment">----------------+------------------------------+----------------------+--+</span></span><br><span class="line">|       ip       |             url              |         _c2          |</span><br><span class="line">+<span class="comment">----------------+------------------------------+----------------------+--+</span></span><br><span class="line">| 192.168.111.3  | http://www.xxx.cn/register   | 2019-08-06 15:35:20  |</span><br><span class="line">| 192.168.133.3  | http://www.xxx.cn/register   | 2019-08-06 15:30:20  |</span><br><span class="line">| 192.168.33.25  | http://www.xxx.cn/job        | 2019-08-06 15:40:20  |</span><br><span class="line">| 192.168.33.3   | http://www.xxx.cn/stu        | 2019-08-05 15:30:20  |</span><br><span class="line">| 192.168.33.3   | http://www.xxx.cn/teach      | 2019-08-04 15:35:20  |</span><br><span class="line">| 192.168.33.36  | http://www.xxx.cn/excersize  | 2019-08-06 16:30:20  |</span><br><span class="line">| 192.168.33.4   | http://www.xxx.cn/job        | 2019-08-04 16:30:20  |</span><br><span class="line">| 192.168.33.4   | http://www.xxx.cn/stu        | 2019-08-04 15:30:20  |</span><br><span class="line">| 192.168.33.44  | http://www.xxx.cn/stu        | 2019-08-05 15:30:20  |</span><br><span class="line">| 192.168.33.46  | http://www.xxx.cn/excersize  | 2019-08-06 16:30:20  |</span><br><span class="line">| 192.168.33.46  | http://www.xxx.cn/job        | 2019-08-05 16:30:20  |</span><br><span class="line">| 192.168.33.5   | http://www.xxx.cn/job        | 2019-08-04 15:40:20  |</span><br><span class="line">| 192.168.33.55  | http://www.xxx.cn/job        | 2019-08-06 15:40:20  |</span><br><span class="line">| 192.168.34.44  | http://www.xxx.cn/pay        | 2019-08-06 15:30:20  |</span><br><span class="line">| 192.168.44.3   | http://www.xxx.cn/teach      | 2019-08-05 15:35:20  |</span><br><span class="line">+<span class="comment">----------------+------------------------------+----------------------+--+</span></span><br></pre></td></tr></table></figure></div>

<h5 id="求8月4号以后，每天http-www-xxx-cn-job的总访问次数，及访问者中ip地址中最大的"><a href="#求8月4号以后，每天http-www-xxx-cn-job的总访问次数，及访问者中ip地址中最大的" class="headerlink" title="求8月4号以后，每天http://www.xxx.cn/job的总访问次数，及访问者中ip地址中最大的"></a>求8月4号以后，每天<a href="http://www.xxx.cn/job的总访问次数，及访问者中ip地址中最大的" target="_blank" rel="noopener">http://www.xxx.cn/job的总访问次数，及访问者中ip地址中最大的</a></h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dt,<span class="string">'http://www.xxx.cn/job'</span>,<span class="keyword">count</span>(<span class="number">1</span>),<span class="keyword">max</span>(ip)</span><br><span class="line"><span class="keyword">from</span> t_pv</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">url</span>=<span class="string">'http://www.xxx.cn/job'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dt <span class="keyword">having</span> dt&gt;<span class="string">'2019-08-04'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> dt,<span class="keyword">max</span>(<span class="keyword">url</span>),<span class="keyword">count</span>(<span class="number">1</span>),<span class="keyword">max</span>(ip)</span><br><span class="line"><span class="keyword">from</span> t_pv</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">url</span>=<span class="string">'http://www.xxx.cn/job'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dt <span class="keyword">having</span> dt&gt;<span class="string">'2019-08-04'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> dt,<span class="keyword">url</span>,<span class="keyword">count</span>(<span class="number">1</span>),<span class="keyword">max</span>(ip)</span><br><span class="line"><span class="keyword">from</span> t_pv</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">url</span>=<span class="string">'http://www.xxx.cn/job'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dt,<span class="keyword">url</span> <span class="keyword">having</span> dt&gt;<span class="string">'2019-08-04'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> dt,<span class="keyword">url</span>,<span class="keyword">count</span>(<span class="number">1</span>),<span class="keyword">max</span>(ip)</span><br><span class="line"><span class="keyword">from</span> t_pv</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">url</span>=<span class="string">'http://www.xxx.cn/job'</span> <span class="keyword">and</span> dt&gt;<span class="string">'2019-08-04'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dt,<span class="keyword">url</span>;</span><br></pre></td></tr></table></figure></div>

<h5 id="求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的"><a href="#求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的" class="headerlink" title="求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的"></a>求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dt,<span class="keyword">url</span>,<span class="keyword">count</span>(<span class="number">1</span>),<span class="keyword">max</span>(ip)</span><br><span class="line"><span class="keyword">from</span> t_pv</span><br><span class="line"><span class="keyword">where</span> dt&gt;<span class="string">'2019-08-04'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dt,<span class="keyword">url</span>;</span><br></pre></td></tr></table></figure></div>

<h5 id="求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的，且只查询出总访问次数-gt-2-的记录"><a href="#求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的，且只查询出总访问次数-gt-2-的记录" class="headerlink" title="求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的，且只查询出总访问次数&gt;2 的记录"></a>求8月4号以后，每天每个页面的总访问次数，及访问者中ip地址中最大的，且只查询出总访问次数&gt;2 的记录</h5><ul>
<li><p>方式1：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select dt,url,count(1) as cnts,max(ip)</span><br><span class="line">from t_pv</span><br><span class="line">where dt&gt;&#39;2019-08-04&#39;</span><br><span class="line">group by dt,url having cnts&gt;2;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>方式2：用子查询</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select dt,url,cnts,max_ip</span><br><span class="line">from</span><br><span class="line">(select dt,url,count(1) as cnts,max(ip) as max_ip</span><br><span class="line">from t_pv</span><br><span class="line">where dt&gt;&#39;2019-08-04&#39;</span><br><span class="line">group by dt,url) tmp</span><br><span class="line">where cnts&gt;2;</span><br></pre></td></tr></table></figure></div>


</li>
</ul>
<h2 id="5-基本数据类型"><a href="#5-基本数据类型" class="headerlink" title="5 基本数据类型"></a>5 基本数据类型</h2><h3 id="5-1-数字类型"><a href="#5-1-数字类型" class="headerlink" title="5.1 数字类型"></a>5.1 数字类型</h3><ul>
<li><p><code>TINYINT</code> (1-byte signed integer, from -128 to 127)</p>
</li>
<li><p><code>SMALLINT</code> (2-byte signed integer, from -32,768 to 32,767)</p>
</li>
<li><p><code>INT/INTEGER</code> (4-byte signed integer, from -2,147,483,648 to 2,147,483,647)</p>
</li>
<li><p><code>BIGINT</code> (8-byte signed integer, from -9,223,372,036,854,775,808 to 9,223,372,036,854,775,807)</p>
</li>
<li><p><code>FLOAT</code> (4-byte single precision floating point number)</p>
</li>
<li><p><code>DOUBLE</code> (8-byte double precision floating point number)</p>
</li>
</ul>
<p>示例：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_test(a <span class="keyword">string</span> ,b <span class="built_in">int</span>,c <span class="built_in">bigint</span>,d <span class="built_in">float</span>,e <span class="keyword">double</span>,f <span class="built_in">tinyint</span>,g <span class="built_in">smallint</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="5-2-日期类型"><a href="#5-2-日期类型" class="headerlink" title="5.2 日期类型"></a>5.2 日期类型</h3><ul>
<li><code>TIMESTAMP</code> (Note: Only available starting with Hive 0.8.0)</li>
<li><code>DATE</code> (Note: Only available starting with Hive 0.12.0)</li>
</ul>
<p>示例，假如有以下数据文件：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1,zhangsan,1985-06-30</span><br><span class="line">2,lisi,1986-07-10</span><br><span class="line">3,wangwu,1985-08-09</span><br></pre></td></tr></table></figure></div>
<p>那么，就可以建一个表来对数据进行映射</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_customer(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="keyword">string</span>,birthday <span class="built_in">date</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span><br></pre></td></tr></table></figure></div>
<p>然后导入数据</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/root/customer.dat'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_customer;</span><br></pre></td></tr></table></figure></div>
<p>然后，就可以正确查询</p>
<h3 id="5-3-字符串类型"><a href="#5-3-字符串类型" class="headerlink" title="5.3 字符串类型"></a>5.3 字符串类型</h3><ul>
<li><code>STRING</code></li>
<li><code>VARCHAR</code> (Note: Only available starting with Hive 0.12.0)</li>
<li><code>CHAR</code> (Note: Only available starting with Hive 0.13.0)</li>
</ul>
<h3 id="5-4-杂类型"><a href="#5-4-杂类型" class="headerlink" title="5.4 杂类型"></a>5.4 杂类型</h3><ul>
<li><code>BOOLEAN</code></li>
<li><code>BINARY</code> (Note: Only available starting with Hive 0.8.0)</li>
</ul>
<h3 id="5-5-复合类型"><a href="#5-5-复合类型" class="headerlink" title="5.5 复合类型"></a>5.5 复合类型</h3><h4 id="5-5-1-数组类型"><a href="#5-5-1-数组类型" class="headerlink" title="5.5.1 数组类型"></a>5.5.1 数组类型</h4><p>有如下数据：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">玩具总动员4,汤姆·汉克斯:蒂姆·艾伦:安妮·波茨,2019-06-21</span><br><span class="line">流浪地球,屈楚萧:吴京:李光洁:吴孟达,2019-02-05</span><br><span class="line">千与千寻,柊瑠美:入野自由:夏木真理:菅原文太,2019-06-21</span><br><span class="line">战狼2,吴京:弗兰克·格里罗:吴刚:张翰:卢靖姗,2017-08-16</span><br></pre></td></tr></table></figure></div>

<p>建表导入数据：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--建表映射：</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_movie(movie_name <span class="keyword">string</span>,actors <span class="built_in">array</span>&lt;<span class="keyword">string</span>&gt;,first_show <span class="built_in">date</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">collection items <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">':'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--导入数据</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/actor.dat'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_movie;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select * from t_movie;</span><br><span class="line">+<span class="comment">---------------------+-----------------------------------+---------------------+--+</span></span><br><span class="line">| t_movie.movie_name  |          t_movie.actors           | t_movie.first_show  |</span><br><span class="line">+<span class="comment">---------------------+-----------------------------------+---------------------+--+</span></span><br><span class="line">| 玩具总动员4              | ["汤姆·汉克斯","蒂姆·艾伦","安妮·波茨"]        | 2019-06-21          |</span><br><span class="line">| 流浪地球                | ["屈楚萧","吴京","李光洁","吴孟达"]          | 2019-02-05          |</span><br><span class="line">| 千与千寻                | ["柊瑠美","入野自由","夏木真理","菅原文太"]      | 2019-06-21          |</span><br><span class="line">| 战狼2                 | ["吴京","弗兰克·格里罗","吴刚","张翰","卢靖姗"]  | 2017-08-16          |</span><br><span class="line">+<span class="comment">---------------------+-----------------------------------+---------------------+--+</span></span><br></pre></td></tr></table></figure></div>
<h5 id="array"><a href="#array" class="headerlink" title="array[]"></a>array[]</h5><h6 id="查询每部电影主演"><a href="#查询每部电影主演" class="headerlink" title="查询每部电影主演"></a>查询每部电影主演</h6><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> movie_name,actors[<span class="number">0</span>],first_show <span class="keyword">from</span> t_movie;</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select movie_name,actors[0],first_show from t_movie;</span><br><span class="line">+<span class="comment">-------------+---------+-------------+--+</span></span><br><span class="line">| movie_name  |   _c1   | first_show  |</span><br><span class="line">+<span class="comment">-------------+---------+-------------+--+</span></span><br><span class="line">| 玩具总动员4      | 汤姆·汉克斯  | 2019-06-21  |</span><br><span class="line">| 流浪地球        | 屈楚萧     | 2019-02-05  |</span><br><span class="line">| 千与千寻        | 柊瑠美     | 2019-06-21  |</span><br><span class="line">| 战狼2         | 吴京      | 2017-08-16  |</span><br><span class="line">+<span class="comment">-------------+---------+-------------+--+</span></span><br></pre></td></tr></table></figure></div>

<h5 id="array-contains"><a href="#array-contains" class="headerlink" title="array_contains"></a>array_contains</h5><h6 id="查询包含’吴京’的电影"><a href="#查询包含’吴京’的电影" class="headerlink" title="查询包含’吴京’的电影"></a>查询包含’吴京’的电影</h6><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> movie_name,actors,first_show</span><br><span class="line"><span class="keyword">from</span> t_movie <span class="keyword">where</span> array_contains(actors,<span class="string">'吴京'</span>);</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select movie_name,actors,first_show</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from t_movie where array_contains(actors,'吴京');</span><br><span class="line">+<span class="comment">-------------+-----------------------------------+-------------+--+</span></span><br><span class="line">| movie_name  |              actors               | first_show  |</span><br><span class="line">+<span class="comment">-------------+-----------------------------------+-------------+--+</span></span><br><span class="line">| 流浪地球        | ["屈楚萧","吴京","李光洁","吴孟达"]          | 2019-02-05  |</span><br><span class="line">| 战狼2         | ["吴京","弗兰克·格里罗","吴刚","张翰","卢靖姗"]  | 2017-08-16  |</span><br><span class="line">+<span class="comment">-------------+-----------------------------------+-------------+--+</span></span><br></pre></td></tr></table></figure></div>

<h5 id="size"><a href="#size" class="headerlink" title="size"></a>size</h5><h6 id="每部电影查询列出的演员数量"><a href="#每部电影查询列出的演员数量" class="headerlink" title="每部电影查询列出的演员数量"></a>每部电影查询列出的演员数量</h6><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> movie_name</span><br><span class="line">,<span class="keyword">size</span>(actors) <span class="keyword">as</span> actor_number</span><br><span class="line">,first_show</span><br><span class="line"><span class="keyword">from</span> t_movie;</span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; from t_movie;</span><br><span class="line">+<span class="comment">-------------+---------------+-------------+--+</span></span><br><span class="line">| movie_name  | actor_number  | first_show  |</span><br><span class="line">+<span class="comment">-------------+---------------+-------------+--+</span></span><br><span class="line">| 玩具总动员4      | 3             | 2019-06-21  |</span><br><span class="line">| 流浪地球        | 4             | 2019-02-05  |</span><br><span class="line">| 千与千寻        | 4             | 2019-06-21  |</span><br><span class="line">| 战狼2         | 5             | 2017-08-16  |</span><br><span class="line">+<span class="comment">-------------+---------------+-------------+--+</span></span><br></pre></td></tr></table></figure></div>


<h4 id="5-5-2-map类型"><a href="#5-5-2-map类型" class="headerlink" title="5.5.2 map类型"></a>5.5.2 map类型</h4><h5 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1,zhangsan,father:xiaoming<span class="comment">#mother:xiaohuang#brother:xiaoxu,28</span></span><br><span class="line">2,lisi,father:mayun<span class="comment">#mother:huangyi#brother:guanyu,22</span></span><br><span class="line">3,wangwu,father:wangjianlin<span class="comment">#mother:ruhua#sister:jingtian,29</span></span><br><span class="line">4,mayun,father:mayongzhen<span class="comment">#mother:angelababy,26</span></span><br></pre></td></tr></table></figure></div>

<p>导入数据</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表映射上述数据</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_family(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="keyword">string</span>,family_members <span class="keyword">map</span>&lt;<span class="keyword">string</span>,<span class="keyword">string</span>&gt;,age <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">collection items <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'#'</span></span><br><span class="line"><span class="keyword">map</span> <span class="keyword">keys</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">':'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 导入数据</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/root/hivetest/fm.dat'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_family;</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select * from t_family;</span><br><span class="line">+<span class="comment">--------------+----------------+----------------------------------------------------------------+---------------+--+</span></span><br><span class="line">| t_family.id  | t_family.name  |                    t_family.family_members                     | t_family.age  |</span><br><span class="line">+<span class="comment">--------------+----------------+----------------------------------------------------------------+---------------+--+</span></span><br><span class="line">| 1            | zhangsan       | &#123;"father":"xiaoming","mother":"xiaohuang","brother":"xiaoxu"&#125;  | 28            |</span><br><span class="line">| 2            | lisi           | &#123;"father":"mayun","mother":"huangyi","brother":"guanyu"&#125;       | 22            |</span><br><span class="line">| 3            | wangwu         | &#123;"father":"wangjianlin","mother":"ruhua","sister":"jingtian"&#125;  | 29            |</span><br><span class="line">| 4            | mayun          | &#123;"father":"mayongzhen","mother":"angelababy"&#125;                  | 26            |</span><br><span class="line">+<span class="comment">--------------+----------------+----------------------------------------------------------------+---------------+--+</span></span><br></pre></td></tr></table></figure></div>


<h5 id="查出每个人的-爸爸、姐妹"><a href="#查出每个人的-爸爸、姐妹" class="headerlink" title="查出每个人的 爸爸、姐妹"></a>查出每个人的 爸爸、姐妹</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,family_members[<span class="string">"father"</span>] <span class="keyword">as</span> father,family_members[<span class="string">"sister"</span>] <span class="keyword">as</span> sister,age</span><br><span class="line"><span class="keyword">from</span> t_family;</span><br></pre></td></tr></table></figure></div>

<h5 id="查出每个人有哪些亲属关系"><a href="#查出每个人有哪些亲属关系" class="headerlink" title="查出每个人有哪些亲属关系"></a>查出每个人有哪些亲属关系</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,map_keys(family_members) <span class="keyword">as</span> relations,age</span><br><span class="line"><span class="keyword">from</span>  t_family;</span><br></pre></td></tr></table></figure></div>
<h5 id="查出每个人的亲人名字"><a href="#查出每个人的亲人名字" class="headerlink" title="查出每个人的亲人名字"></a>查出每个人的亲人名字</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,map_values(family_members) <span class="keyword">as</span> relations,age</span><br><span class="line"><span class="keyword">from</span>  t_family;</span><br></pre></td></tr></table></figure></div>

<h5 id="查出每个人的亲人数量"><a href="#查出每个人的亲人数量" class="headerlink" title="查出每个人的亲人数量"></a>查出每个人的亲人数量</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,<span class="keyword">size</span>(family_members) <span class="keyword">as</span> relations,age</span><br><span class="line"><span class="keyword">from</span>  t_family;</span><br></pre></td></tr></table></figure></div>

<h5 id="查出所有拥有兄弟的人及他的兄弟是谁"><a href="#查出所有拥有兄弟的人及他的兄弟是谁" class="headerlink" title="查出所有拥有兄弟的人及他的兄弟是谁"></a>查出所有拥有兄弟的人及他的兄弟是谁</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方案1：一句话写完</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,age,family_members[<span class="string">'brother'</span>]</span><br><span class="line"><span class="keyword">from</span> t_family  <span class="keyword">where</span> array_contains(map_keys(family_members),<span class="string">'brother'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 方案2：子查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,age,family_members[<span class="string">'brother'</span>]</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,age,map_keys(family_members) <span class="keyword">as</span> relations,family_members </span><br><span class="line"><span class="keyword">from</span> t_family) tmp </span><br><span class="line"><span class="keyword">where</span> array_contains(relations,<span class="string">'brother'</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="5-5-3-stuct类型"><a href="#5-5-3-stuct类型" class="headerlink" title="5.5.3 stuct类型"></a>5.5.3 stuct类型</h4><p>数据</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1,zhangsan,18:male:深圳</span><br><span class="line">2,lisi,28:female:北京</span><br><span class="line">3,wangwu,38:male:广州</span><br><span class="line">4,laowang,26:female:上海</span><br><span class="line">5,yangyang,35:male:杭州</span><br></pre></td></tr></table></figure></div>
<p>导入数据：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- 建表映射上述数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> t_user;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user(<span class="keyword">id</span> <span class="built_in">int</span>,<span class="keyword">name</span> <span class="keyword">string</span>,info <span class="keyword">struct</span>&lt;age:<span class="built_in">int</span>,sex:<span class="keyword">string</span>,addr:<span class="keyword">string</span>&gt;)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line">collection items <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">':'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 导入数据</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/user.dat'</span> <span class="keyword">into</span> <span class="keyword">table</span> t_user;</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select * from t_user;</span><br><span class="line">+<span class="comment">------------+--------------+----------------------------------------+--+</span></span><br><span class="line">| t_user.id  | t_user.name  |              t_user.info               |</span><br><span class="line">+<span class="comment">------------+--------------+----------------------------------------+--+</span></span><br><span class="line">| 1          | zhangsan     | &#123;"age":18,"sex":"male","addr":"深圳"&#125;    |</span><br><span class="line">| 2          | lisi         | &#123;"age":28,"sex":"female","addr":"北京"&#125;  |</span><br><span class="line">| 3          | wangwu       | &#123;"age":38,"sex":"male","addr":"广州"&#125;    |</span><br><span class="line">| 4          | laowang      | &#123;"age":26,"sex":"female","addr":"上海"&#125;  |</span><br><span class="line">| 5          | yangyang     | &#123;"age":35,"sex":"male","addr":"杭州"&#125;    |</span><br><span class="line">+<span class="comment">------------+--------------+----------------------------------------+--+</span></span><br></pre></td></tr></table></figure></div>

<h5 id="查询每个人的id-name和地址"><a href="#查询每个人的id-name和地址" class="headerlink" title="查询每个人的id name和地址"></a>查询每个人的id name和地址</h5><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span>,info.addr</span><br><span class="line"><span class="keyword">from</span> t_user;</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select id,name,info.addr</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; from t_user;</span><br><span class="line">+<span class="comment">-----+-----------+-------+--+</span></span><br><span class="line">| id  |   name    | addr  |</span><br><span class="line">+<span class="comment">-----+-----------+-------+--+</span></span><br><span class="line">| 1   | zhangsan  | 深圳    |</span><br><span class="line">| 2   | lisi      | 北京    |</span><br><span class="line">| 3   | wangwu    | 广州    |</span><br><span class="line">| 4   | laowang   | 上海    |</span><br><span class="line">| 5   | yangyang  | 杭州    |</span><br><span class="line">+<span class="comment">-----+-----------+-------+--+</span></span><br></pre></td></tr></table></figure></div>


<h2 id="6-常用内置函数"><a href="#6-常用内置函数" class="headerlink" title="6 常用内置函数"></a>6 常用内置函数</h2><p>测试函数</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">substr</span>(<span class="string">"abcdef"</span>,<span class="number">1</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure></div>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select substr("abcdef",1,3);</span><br><span class="line">+<span class="comment">------+--+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+--+</span></span><br><span class="line">| abc  |</span><br><span class="line">+<span class="comment">------+--+</span></span><br></pre></td></tr></table></figure></div>


<h3 id="6-1-时间处理函数"><a href="#6-1-时间处理函数" class="headerlink" title="6.1 时间处理函数"></a>6.1 时间处理函数</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from_unixtime(21938792183,'yyyy-MM-dd HH:mm:ss')</span><br></pre></td></tr></table></figure></div>
<p>返回： ‘2017-06-03 17:50:30’</p>
<h3 id="6-2-类型转换函数"><a href="#6-2-类型转换函数" class="headerlink" title="6.2 类型转换函数"></a>6.2 类型转换函数</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">cast</span>(<span class="string">"8"</span> <span class="keyword">as</span> <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">cast</span>(<span class="string">"2019-2-3"</span> <span class="keyword">as</span> <span class="keyword">data</span>)</span><br></pre></td></tr></table></figure></div>


<h3 id="6-3-字符串截取和拼接"><a href="#6-3-字符串截取和拼接" class="headerlink" title="6.3 字符串截取和拼接"></a>6.3 字符串截取和拼接</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">substr("abcde",1,3)  <span class="comment">--&gt;   'abc'</span></span><br><span class="line">concat('abc','def')  <span class="comment">--&gt;  'abcdef'</span></span><br></pre></td></tr></table></figure></div>

<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:hive2://Master:10000&gt; select substr("abcde",1,3);</span><br><span class="line">+<span class="comment">------+--+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+--+</span></span><br><span class="line">| abc  |</span><br><span class="line">+<span class="comment">------+--+</span></span><br><span class="line">1 row selected (0.152 seconds)</span><br><span class="line">0: jdbc:hive2://Master:10000&gt; select concat('abc','def');</span><br><span class="line">+<span class="comment">---------+--+</span></span><br><span class="line">|   _c0   |</span><br><span class="line">+<span class="comment">---------+--+</span></span><br><span class="line">| abcdef  |</span><br><span class="line">+<span class="comment">---------+--+</span></span><br><span class="line">1 row selected (0.165 seconds)</span><br></pre></td></tr></table></figure></div>

<h3 id="6-4-Json数据解析函数"><a href="#6-4-Json数据解析函数" class="headerlink" title="6.4 Json数据解析函数"></a>6.4 Json数据解析函数</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_json_object('&#123;\"key1\":3333，\"key2\":4444&#125;' , '$.key1')</span><br></pre></td></tr></table></figure></div>

<p>返回：<code>3333</code></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json_tuple('&#123;\"key1\":3333，\"key2\":4444&#125;','key1','key2') as(key1,key2)</span><br></pre></td></tr></table></figure></div>
<p>返回：<code>3333, 4444</code></p>
<h3 id="6-5-url解析函数"><a href="#6-5-url解析函数" class="headerlink" title="6.5 url解析函数"></a>6.5 url解析函数</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parse_url_tuple('http://www.xxxx.cn/bigdata?userid=8888','HOST','PATH','QUERY','QUERY:userid')</span><br></pre></td></tr></table></figure></div>

<p>返回： <code>www.xxxx.cn  /bigdata     userid=8888   8888</code></p>
<h2 id="7-自定义函数"><a href="#7-自定义函数" class="headerlink" title="7 自定义函数"></a>7 自定义函数</h2><h3 id="7-1-问题"><a href="#7-1-问题" class="headerlink" title="7.1 问题"></a>7.1 问题</h3><p>测试数据如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1,zhangsan:18-1999063117:30:00-beijing</span><br><span class="line">2,lisi:28-1989063117:30:00-shanghai</span><br><span class="line">3,wangwu:20-1997063117:30:00-tieling</span><br></pre></td></tr></table></figure></div>

<p>建表导入数据：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user_info(info <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span>;</span><br></pre></td></tr></table></figure></div>

<p>导入数据：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data <span class="built_in">local</span> inpath <span class="string">'/root/udftest.data'</span> into table t_user_info;</span><br></pre></td></tr></table></figure></div>

<p>需求：利用上表生成如下新表</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t_user：uid,uname,age,birthday,address</span><br></pre></td></tr></table></figure></div>

<p>思路：可以自定义一个函数parse_user_info()，能传入一行上述数据，返回切分好的字段</p>
<p>然后可以通过如下sql完成需求：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">sql</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> t_user</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">parse_user_info(info,<span class="number">0</span>) <span class="keyword">as</span> uid,</span><br><span class="line">parse_user_info(info,<span class="number">1</span>) <span class="keyword">as</span> uname,</span><br><span class="line">parse_user_info(info,<span class="number">2</span>) <span class="keyword">as</span> age,</span><br><span class="line">parse_user_info(info,<span class="number">3</span>) <span class="keyword">as</span> birthday_date,</span><br><span class="line">parse_user_info(info,<span class="number">4</span>) <span class="keyword">as</span> birthday_time,</span><br><span class="line">parse_user_info(info,<span class="number">5</span>) <span class="keyword">as</span> address</span><br><span class="line"><span class="keyword">from</span> t_user_info;</span><br></pre></td></tr></table></figure></div>

<p>实现关键：  自定义parse_user_info() 函数</p>
<h3 id="7-2-实现步骤"><a href="#7-2-实现步骤" class="headerlink" title="7.2 实现步骤"></a>7.2 实现步骤</h3><p>1、写一个java类实现函数所需要的功能</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoParser</span> <span class="keyword">extends</span> <span class="title">UDF</span></span>&#123;	</span><br><span class="line">	<span class="comment">// 1,zhangsan:18-1999063117:30:00-beijing</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">evaluate</span><span class="params">(String line,<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		String newLine = line.replaceAll(<span class="string">","</span>, <span class="string">"\001"</span>).replaceAll(<span class="string">":"</span>, <span class="string">"\001"</span>).replaceAll(<span class="string">"-"</span>, <span class="string">"\001"</span>);</span><br><span class="line">		StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		String[] split = newLine.split(<span class="string">"\001"</span>);</span><br><span class="line">		StringBuilder append = sb.append(split[<span class="number">0</span>])</span><br><span class="line">		.append(<span class="string">"\t"</span>)</span><br><span class="line">		.append(split[<span class="number">1</span>])</span><br><span class="line">		.append(<span class="string">"\t"</span>)</span><br><span class="line">		.append(split[<span class="number">2</span>])</span><br><span class="line">		.append(<span class="string">"\t"</span>)</span><br><span class="line">		.append(split[<span class="number">3</span>].substring(<span class="number">0</span>, <span class="number">8</span>))</span><br><span class="line">		.append(<span class="string">"\t"</span>)</span><br><span class="line">		.append(split[<span class="number">3</span>].substring(<span class="number">8</span>, <span class="number">10</span>)).append(split[<span class="number">4</span>]).append(split[<span class="number">5</span>])</span><br><span class="line">		.append(<span class="string">"\t"</span>)</span><br><span class="line">		.append(split[<span class="number">6</span>]);</span><br><span class="line">		</span><br><span class="line">		String res = append.toString();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> res.split(<span class="string">"\t"</span>)[index];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>2、将java类打成jar包: d:/up.jar</p>
<p>3、上传jar包到hive所在的机器上  /root/up.jar</p>
<p>4、在hive的提示符中添加jar包</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;  add jar /root/up.jar;</span><br></pre></td></tr></table></figure></div>

<p>5、创建一个hive的自定义函数名 跟  写好的jar包中的java类对应</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;  create temporary function parse_user_info as 'com.doit.hive.udf.UserInfoParser';</span><br></pre></td></tr></table></figure></div>

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">foochane</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://foochane.cn/article/2019062501.html">https://foochane.cn/article/2019062501.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://foochane.cn">foochane</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据    </a><a class="post-meta__tags" href="/tags/hive/">hive    </a></div><div class="post_share"><div class="social-share" data-image="/images/cover/11.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/images/site/reward/wechat.png" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/images/site/reward/alipay.png" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/article/2019062601.html"><img class="prev_cover lazyload" data-src="/images/cover/13.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>zookeeper的安装和使用</span></div></a></div><div class="next-post pull_right"><a href="/article/2019062401.html"><img class="next_cover lazyload" data-src="/images/cover/10.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>MySQL常用操作记录</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019051903.html" title="Hive的安装及配置"><img class="relatedPosts_cover lazyload"data-src="/images/cover/5.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-05-19</div><div class="relatedPosts_title">Hive的安装及配置</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019051902.html" title="HDFS命令行客户端的常用操作命令"><img class="relatedPosts_cover lazyload"data-src="/images/cover/4.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-05-19</div><div class="relatedPosts_title">HDFS命令行客户端的常用操作命令</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019051901.html" title="Hadoop分布式集群的搭建"><img class="relatedPosts_cover lazyload"data-src="/images/cover/3.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-05-19</div><div class="relatedPosts_title">Hadoop分布式集群的搭建</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019051904.html" title="Spark的安装及配置"><img class="relatedPosts_cover lazyload"data-src="/images/cover/6.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-05-19</div><div class="relatedPosts_title">Spark的安装及配置</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019061301.html" title="Spark相关知识介绍"><img class="relatedPosts_cover lazyload"data-src="/images/cover/9.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-06-13</div><div class="relatedPosts_title">Spark相关知识介绍</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019060601.html" title="PySpark SQL 相关知识介绍"><img class="relatedPosts_cover lazyload"data-src="/images/cover/7.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-06-06</div><div class="relatedPosts_title">PySpark SQL 相关知识介绍</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = true == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'zCeKCftRr91sIth6b8UsWKb9-gzGzoHsz',
  appKey:'SIMyV1MuzsbUpvUErd6bUlC2',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" style="background-image: url(/images/banner/0.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2022 By foochane</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>