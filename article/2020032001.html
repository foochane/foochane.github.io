<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>SpringBoot接入支付宝支付 | foochane</title><meta name="description" content="SpringBoot接入支付宝支付"><meta name="keywords" content="Java"><meta name="author" content="foochane"><meta name="copyright" content="foochane"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/images/site/favicon.png"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SpringBoot接入支付宝支付"><meta name="twitter:description" content="SpringBoot接入支付宝支付"><meta name="twitter:image" content="https://foochane.cn/images/cover/11.jpg"><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot接入支付宝支付"><meta property="og:url" content="https://foochane.cn/article/2020032001"><meta property="og:site_name" content="foochane"><meta property="og:description" content="SpringBoot接入支付宝支付"><meta property="og:image" content="https://foochane.cn/images/cover/11.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://foochane.cn/article/2020032001"><link rel="prev" title="SpringBoot接入微信支付" href="https://foochane.cn/article/2020032501.html"><link rel="next" title="Java学习笔记（十四）：MySQL数据库" href="https://foochane.cn/article/2020011301.html"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e75706f2332bc6bbea2cc9a3372553f0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: true,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="foochane" type="application/atom+xml">
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">foochane</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/images/site/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">61</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">9</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-开发前的准备"><span class="toc_mobile_items-text">1 开发前的准备</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-1-密钥的的生成"><span class="toc_mobile_items-text">1.1 密钥的的生成</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-2-创建应用配置账号信息"><span class="toc_mobile_items-text">1.2 创建应用配置账号信息</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-3-开发需要的参数"><span class="toc_mobile_items-text">1.3 开发需要的参数</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-支付介绍"><span class="toc_mobile_items-text">2 支付介绍</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-1-支付逻辑"><span class="toc_mobile_items-text">2.1 支付逻辑</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-2-关于支付宝中同步通知和异步通知的理解"><span class="toc_mobile_items-text">2.2 关于支付宝中同步通知和异步通知的理解</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-3-重点看官方的Demo"><span class="toc_mobile_items-text">2.3 重点看官方的Demo</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-支付接入代码"><span class="toc_mobile_items-text">3 支付接入代码</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-1-添加依赖"><span class="toc_mobile_items-text">3.1 添加依赖</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-2-添加配置类"><span class="toc_mobile_items-text">3.2 添加配置类</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-3-编写支付代码"><span class="toc_mobile_items-text">3.3 编写支付代码</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-同步通知代码"><span class="toc_mobile_items-text">4 同步通知代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-异步通知代码"><span class="toc_mobile_items-text">5 异步通知代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#6-订单查询代码"><span class="toc_mobile_items-text">6 订单查询代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#8-退款代码代码"><span class="toc_mobile_items-text">8 退款代码代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#9-退款查询代码"><span class="toc_mobile_items-text">9 退款查询代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#10-订单关闭代码"><span class="toc_mobile_items-text">10 订单关闭代码</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#11-完整的代码地址"><span class="toc_mobile_items-text">11 完整的代码地址</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-开发前的准备"><span class="toc-text">1 开发前的准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-密钥的的生成"><span class="toc-text">1.1 密钥的的生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-创建应用配置账号信息"><span class="toc-text">1.2 创建应用配置账号信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-开发需要的参数"><span class="toc-text">1.3 开发需要的参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-支付介绍"><span class="toc-text">2 支付介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-支付逻辑"><span class="toc-text">2.1 支付逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-关于支付宝中同步通知和异步通知的理解"><span class="toc-text">2.2 关于支付宝中同步通知和异步通知的理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-重点看官方的Demo"><span class="toc-text">2.3 重点看官方的Demo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-支付接入代码"><span class="toc-text">3 支付接入代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-添加依赖"><span class="toc-text">3.1 添加依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-添加配置类"><span class="toc-text">3.2 添加配置类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-编写支付代码"><span class="toc-text">3.3 编写支付代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-同步通知代码"><span class="toc-text">4 同步通知代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-异步通知代码"><span class="toc-text">5 异步通知代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-订单查询代码"><span class="toc-text">6 订单查询代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-退款代码代码"><span class="toc-text">8 退款代码代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-退款查询代码"><span class="toc-text">9 退款查询代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-订单关闭代码"><span class="toc-text">10 订单关闭代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-完整的代码地址"><span class="toc-text">11 完整的代码地址</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(/images/banner/0.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">SpringBoot接入支付宝支付</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-03-20</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/">Java</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.7k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 14 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/article/2020032001.html#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/article/2020032001.html" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h2 id="1-开发前的准备"><a href="#1-开发前的准备" class="headerlink" title="1 开发前的准备"></a>1 开发前的准备</h2><h3 id="1-1-密钥的的生成"><a href="#1-1-密钥的的生成" class="headerlink" title="1.1 密钥的的生成"></a>1.1 密钥的的生成</h3><p>先去官网下载支付宝平台助手，下载地址：<a href="https://opendocs.alipay.com/open/291/105971" target="_blank" rel="noopener">https://opendocs.alipay.com/open/291/105971</a> ，下载并安装平台助手，使用平台助手生成<code>应用公钥</code>和<code>应用私钥</code>。</p>
<h3 id="1-2-创建应用配置账号信息"><a href="#1-2-创建应用配置账号信息" class="headerlink" title="1.2 创建应用配置账号信息"></a>1.2 创建应用配置账号信息</h3><p>沙箱账号申请地址：<a href="https://openhome.alipay.com/platform/appDaily.htm" target="_blank" rel="noopener">https://openhome.alipay.com/platform/appDaily.htm</a></p>
<p>正式账号申请地址：<a href="https://open.alipay.com/platform/manageHome.htm" target="_blank" rel="noopener">https://open.alipay.com/platform/manageHome.htm</a></p>
<p>为了保证交易双方（商户和支付宝）的身份和数据安全，开发者在调用接口前，需要配置双方密钥，对交易数据进行双方校验。密钥包含应用私钥<code>（APP_PRIVATE_KEY）</code>和应用公钥<code>（APP_PUBLIC_KEY）</code>。生成密钥后，开发者需要在开放平台开发者中心进行密钥配置，配置完成后可以获取支付宝公钥<code>（ALIPAY_PUBLIC_KEY）</code>应用在代码中，对请求内容进行签名。</p>
<blockquote>
<p>注意：当设置了应用公钥后，才可以查看支付宝公钥</p>
</blockquote>
<h3 id="1-3-开发需要的参数"><a href="#1-3-开发需要的参数" class="headerlink" title="1.3 开发需要的参数"></a>1.3 开发需要的参数</h3><ul>
<li><p><code>appid</code>： 应用ID</p>
</li>
<li><p><code>private_key</code>：由支付宝开发平台助手生成的应用私钥</p>
</li>
<li><p><code>alipay_public_key</code>：是支付宝公钥，支付宝开发平台助手生成的应用公钥</p>
<p><strong>这里特别需要注意的是<code>alipay_public_key</code>是蚂蚁金服开放平台获取的支付宝公钥，不是本地平台助手申请的<code>应用公钥</code>，不要弄错了，否则会签名失败</strong> </p>
</li>
</ul>
<h2 id="2-支付介绍"><a href="#2-支付介绍" class="headerlink" title="2 支付介绍"></a>2 支付介绍</h2><h3 id="2-1-支付逻辑"><a href="#2-1-支付逻辑" class="headerlink" title="2.1 支付逻辑"></a>2.1 支付逻辑</h3><ol>
<li><p>用户在商户系统下单</p>
</li>
<li><p>商户系统调用支付宝的支付接口，发起支付请求</p>
</li>
<li><p>用户登录，选择支付渠道，输入支付密码</p>
</li>
<li><p>支付宝get请求<code>returnUrl</code>， 返回同步通知参数 </p>
</li>
<li><p>支付宝post请求<code>notifyUrl</code>，返回异步通知参数</p>
</li>
<li><p>商户可以通过 交易查询接口查询交易状态</p>
</li>
<li><p>如果用户或者商户想退款，可以发起退款请求</p>
</li>
<li><p>如果退款可以调用退款查询接口，查询退款信息</p>
</li>
<li><p>下载对账单</p>
</li>
</ol>
<h3 id="2-2-关于支付宝中同步通知和异步通知的理解"><a href="#2-2-关于支付宝中同步通知和异步通知的理解" class="headerlink" title="2.2 关于支付宝中同步通知和异步通知的理解"></a>2.2 关于支付宝中同步通知和异步通知的理解</h3><p>在调用支付宝接口的时候，确认支付以后我们需要请求两个通知接口：同步通知（<code>returnUrl</code>）和异步通知（<code>notifyUrl</code>）。刚开始看文档的时候也不是很清楚这两个接口有什么区别，从流程图里面描述到的是，同步通知（<code>returnUrl</code>）是GET请求，“支付是否成功以异步通知为准”。异步通知（<code>notifyUrl</code>）是POST请求，但是图里面还是说了一句“支付是否成功以查询接口返回为准”。所以最终支付是否成功还是要看查询接口的返回结果，那同步通知和异步通知有什么用呢？</p>
<p>个人的理解是：只要同步通知和异步通知返回成功一般情况下其实已经可以认为支付成功了，我们就已经可以进行下一步的操作了。同步通知用于前端界面及时反馈给用户，告诉用户支付操作已经完成，然后让前端页面跳转的需要跳转的页面；异步通知用于后台业务逻辑的处理。当然为了保险，后面最好还是调用查询接口，对支付账单进行核对。</p>
<p><a href="https://foochane.cn/images/2020/001.jpg" data-fancybox="group" data-caption="001" class="fancybox"><img alt="001" data-src="https://foochane.cn/images/2020/001.jpg" class="lazyload" title="001"></a></p>
<p>需要注意的问题：</p>
<ol>
<li><code>returnUrl</code>和<code>returnUrl</code>这两个的接口地址必须放在公网上，需要外网能访问到，否则支付宝是调不到这两个接口的。本地测试可以使用 natapp 做内外网穿透。</li>
<li>经过测试异步通知和同步通知没有很明确的先后顺序，同步通知并不一定在异步通知之前被调用。</li>
</ol>
<h3 id="2-3-重点看官方的Demo"><a href="#2-3-重点看官方的Demo" class="headerlink" title="2.3 重点看官方的Demo"></a>2.3 重点看官方的Demo</h3><p>其实官方的Demo已经写的很详细了，每个接口的调用已经给出了详细的演示。所以后面的代码基本也是照着官方的Demo来的。</p>
<p>电脑网站支付Demo下载：<a href="https://opendocs.alipay.com/open/270/106291" target="_blank" rel="noopener">https://opendocs.alipay.com/open/270/106291</a></p>
<h2 id="3-支付接入代码"><a href="#3-支付接入代码" class="headerlink" title="3 支付接入代码"></a>3 支付接入代码</h2><h3 id="3-1-添加依赖"><a href="#3-1-添加依赖" class="headerlink" title="3.1 添加依赖"></a>3.1 添加依赖</h3><p>这里使用的是<code>SpringBoot</code>，先在maven里引入官方的依赖：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支付宝 alipay sdk --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alipay.sdk/alipay-sdk-java --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9.124.ALL<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>



<h3 id="3-2-添加配置类"><a href="#3-2-添加配置类" class="headerlink" title="3.2 添加配置类"></a>3.2 添加配置类</h3><p>接着添加已经配置类：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foochane.awpay.test.config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by foochane on 2020/5/2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAliPayConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// natapp内外网穿透地址</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String natUrl = <span class="string">"http://znznca.natappfree.cc"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 应用ID,您的APPID，收款账号既是您的APPID对应支付宝账号</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String app_id = <span class="string">"2016101800717168"</span>;<span class="comment">//在后台获取（必须配置）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 商户私钥，您的PKCS8格式RSA2私钥 ,使用支付宝平台助手生成</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String merchant_private_key = <span class="string">"xxxxxxxxxxxxxx"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 支付宝公钥,查看地址：https://openhome.alipay.com/platform/keyManage.html 对应APPID下的支付宝公钥。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String alipay_public_key = <span class="string">"xxxxxxxxx"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 服务器异步通知页面路径  需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String notify_url = natUrl + <span class="string">"/ali/pay/notify"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 页面跳转同步通知页面路径 需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String return_url = natUrl + <span class="string">"/ali/pay/return"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 签名方式</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String sign_type = <span class="string">"RSA2"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字符编码格式</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String charset = <span class="string">"utf-8"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 支付宝网关</span></span><br><span class="line">    <span class="comment">//注意：沙箱测试环境，正式环境为：https://openapi.alipay.com/gateway.do</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String gatewayUrl = <span class="string">"https://openapi.alipaydev.com/gateway.do"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="3-3-编写支付代码"><a href="#3-3-编写支付代码" class="headerlink" title="3.3 编写支付代码"></a>3.3 编写支付代码</h3><p>然后就可以在Controller层编写支付代码了，这里只是为了演示，所以就之编写controller层。</p>
<p>这里引入的是电脑网站支付，代码流程如下：</p>
<ol>
<li>创建<code>AlipayClient</code> 类</li>
<li>设置请求参数（这里参数是写死的）</li>
<li>发起支付请求，获取支付表单</li>
<li>直接将支付表单输出到页面</li>
</ol>
<p>具体代码如下：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.foochane.awpay.test.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alipay.api.AlipayApiException;</span><br><span class="line"><span class="keyword">import</span> com.alipay.api.AlipayClient;</span><br><span class="line"><span class="keyword">import</span> com.alipay.api.DefaultAlipayClient;</span><br><span class="line"><span class="keyword">import</span> com.alipay.api.internal.util.AlipaySignature;</span><br><span class="line"><span class="keyword">import</span> com.alipay.api.request.*;</span><br><span class="line"><span class="keyword">import</span> com.foochane.awpay.test.config.MyAliPayConfig;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by foochane on 2020/5/2.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlipayController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"ali/pay/order/create"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span> <span class="params">(HttpServletRequest httpRequest,</span></span></span><br><span class="line"><span class="function"><span class="params">                     HttpServletResponse httpResponse)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1 创建AlipayClient</span></span><br><span class="line">        AlipayClient alipayClient =  <span class="keyword">new</span> DefaultAlipayClient(  MyAliPayConfig.gatewayUrl,</span><br><span class="line">                MyAliPayConfig.app_id,</span><br><span class="line">                MyAliPayConfig.merchant_private_key,</span><br><span class="line">                <span class="string">"json"</span>,</span><br><span class="line">                MyAliPayConfig.charset,</span><br><span class="line">                MyAliPayConfig.alipay_public_key,</span><br><span class="line">                MyAliPayConfig.sign_type);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 设置请求参数</span></span><br><span class="line">        <span class="comment">//商户订单号，商户网站订单系统中唯一订单号，必填</span></span><br><span class="line">        String out_trade_no = <span class="string">"P"</span>+System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//付款金额，必填</span></span><br><span class="line">        String total_amount = <span class="string">"80"</span>;</span><br><span class="line">        <span class="comment">//订单名称，必填</span></span><br><span class="line">        String subject = <span class="string">"商品购买"</span>;</span><br><span class="line">        <span class="comment">//商品描述，可空</span></span><br><span class="line">        String body = <span class="string">"购买商品的描述信息"</span>;</span><br><span class="line">        <span class="comment">// 该笔订单允许的最晚付款时间，逾期将关闭交易。取值范围：1m～15d。m-分钟，h-小时，d-天，1c-当天（1c-当天的情况下，无论交易何时创建，都在0点关闭）。 该参数数值不接受小数点， 如 1.5h，可转换为 90m。</span></span><br><span class="line">        String timeout_express = <span class="string">"10m"</span>;</span><br><span class="line">        AlipayTradePagePayRequest alipayRequest =  <span class="keyword">new</span>  AlipayTradePagePayRequest(); <span class="comment">//创建API对应的request</span></span><br><span class="line">        alipayRequest.setReturnUrl(MyAliPayConfig.return_url);</span><br><span class="line">        alipayRequest.setNotifyUrl(MyAliPayConfig.notify_url); <span class="comment">//在公共参数中设置回跳和通知地址</span></span><br><span class="line">        alipayRequest.setBizContent(<span class="string">"&#123;\"out_trade_no\":\""</span> + out_trade_no + <span class="string">"\","</span></span><br><span class="line">                + <span class="string">"\"total_amount\":\""</span> + total_amount + <span class="string">"\","</span></span><br><span class="line">                + <span class="string">"\"subject\":\""</span> + subject + <span class="string">"\","</span></span><br><span class="line">                + <span class="string">"\"body\":\""</span> + body + <span class="string">"\","</span></span><br><span class="line">                + <span class="string">"\"timeout_express\":\""</span> + timeout_express + <span class="string">"\","</span></span><br><span class="line">                + <span class="string">"\"product_code\":\"FAST_INSTANT_TRADE_PAY\"&#125;"</span>); <span class="comment">//填充业务参数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3 发起支付请求</span></span><br><span class="line">        String form = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">try</span>  &#123;</span><br><span class="line">            form = alipayClient.pageExecute(alipayRequest).getBody();  <span class="comment">//调用SDK生成表单</span></span><br><span class="line">        &#125;  <span class="keyword">catch</span>  (AlipayApiException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"*************************** 支付请求成功 *******************************"</span>);</span><br><span class="line">        System.out.println(<span class="string">"返回表单："</span>);</span><br><span class="line">        System.out.println(form);</span><br><span class="line">        System.out.println(<span class="string">"*************************** 支付请求成功 *******************************"</span>);</span><br><span class="line"></span><br><span class="line">        httpResponse.setContentType( <span class="string">"text/html;charset="</span>  + MyAliPayConfig.charset);</span><br><span class="line">        httpResponse.getWriter().write(form); <span class="comment">//直接将完整的表单html输出到页面</span></span><br><span class="line">        httpResponse.getWriter().flush();</span><br><span class="line">        httpResponse.getWriter().close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="4-同步通知代码"><a href="#4-同步通知代码" class="headerlink" title="4 同步通知代码"></a>4 同步通知代码</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 支付宝同步通知页面</span></span><br><span class="line"><span class="comment">  * return_url必须放在公网上</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"ali/pay/return"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">returnUrl</span><span class="params">(HttpServletRequest httpRequest,</span></span></span><br><span class="line"><span class="function"><span class="params">                         HttpServletResponse httpResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">     System.out.println(<span class="string">"支付成功, 进入同步通知接口..."</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 获取支付宝GET过来反馈信息</span></span><br><span class="line">     Map&lt;String, String&gt; params = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">     Map&lt;String, String[]&gt; requestParams = httpRequest.getParameterMap();</span><br><span class="line">     <span class="keyword">for</span> (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext(); ) &#123;</span><br><span class="line">         String name = (String) iter.next();</span><br><span class="line">         String[] values = (String[]) requestParams.get(name);</span><br><span class="line">         String valueStr = <span class="string">""</span>;</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">             valueStr = (i == values.length - <span class="number">1</span>) ? valueStr + values[i]</span><br><span class="line">                     : valueStr + values[i] + <span class="string">","</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 乱码解决，这段代码在出现乱码时使用</span></span><br><span class="line">         <span class="comment">// valueStr = new String(valueStr.getBytes("ISO-8859-1"), "utf-8");</span></span><br><span class="line"></span><br><span class="line">         params.put(name, valueStr);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 调用SDK验证签名</span></span><br><span class="line">     <span class="keyword">boolean</span> signVerified = AlipaySignature.rsaCheckV1(params,</span><br><span class="line">                                                       MyAliPayConfig.alipay_public_key,</span><br><span class="line">                                                       MyAliPayConfig.charset,</span><br><span class="line">                                                       MyAliPayConfig.sign_type);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">// 验签成功</span></span><br><span class="line">     <span class="keyword">if</span> (signVerified) &#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 同步通知返回的参数（部分说明）</span></span><br><span class="line">         <span class="comment">// out_trade_no :	商户订单号</span></span><br><span class="line">         <span class="comment">// trade_no : 支付宝交易号</span></span><br><span class="line">         <span class="comment">// total_amount ： 交易金额</span></span><br><span class="line">         <span class="comment">// auth_app_id/app_id : 商户APPID</span></span><br><span class="line">         <span class="comment">// seller_id ：收款支付宝账号对应的支付宝唯一用户号(商户UID )</span></span><br><span class="line">         System.out.println(<span class="string">"****************** 支付宝同步通知成功   ******************"</span>);</span><br><span class="line">         System.out.println(<span class="string">"同步通知返回参数："</span> + params.toString());</span><br><span class="line">         System.out.println(<span class="string">"****************** 支付宝同步通知成功   ******************"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         System.out.println(<span class="string">"支付, 验签失败..."</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 返回支付操作完成后需要跳转的页面,这里把返回的参数直接传给页面</span></span><br><span class="line">     <span class="keyword">return</span> params.toString();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="5-异步通知代码"><a href="#5-异步通知代码" class="headerlink" title="5 异步通知代码"></a>5 异步通知代码</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 支付宝服务器异步通知</span></span><br><span class="line"><span class="comment">  * notify_url必须放入公网</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@RequestMapping</span>(value = <span class="string">"/ali/pay/notify"</span>)</span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">notify</span><span class="params">(HttpServletRequest request, HttpServletRequest response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">     System.out.println(<span class="string">"支付成功, 进入异步通知接口..."</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//获取支付宝POST过来反馈信息</span></span><br><span class="line">     Map&lt;String, String&gt; params = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">     Map&lt;String, String[]&gt; requestParams = request.getParameterMap();</span><br><span class="line">     <span class="keyword">for</span> (Iterator&lt;String&gt; iter = requestParams.keySet().iterator(); iter.hasNext(); ) &#123;</span><br><span class="line">         String name = (String) iter.next();</span><br><span class="line">         String[] values = (String[]) requestParams.get(name);</span><br><span class="line">         String valueStr = <span class="string">""</span>;</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">             valueStr = (i == values.length - <span class="number">1</span>) ? valueStr + values[i]</span><br><span class="line">                     : valueStr + values[i] + <span class="string">","</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">//乱码解决，这段代码在出现乱码时使用</span></span><br><span class="line"><span class="comment">// valueStr = new String(valueStr.getBytes("ISO-8859-1"), "utf-8");</span></span><br><span class="line"></span><br><span class="line">         params.put(name, valueStr);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">boolean</span> signVerified = AlipaySignature.rsaCheckV1(params,</span><br><span class="line">                                                       MyAliPayConfig.alipay_public_key,</span><br><span class="line">                                                       MyAliPayConfig.charset,</span><br><span class="line">                                                       MyAliPayConfig.sign_type); <span class="comment">//调用SDK验证签名</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (signVerified) &#123;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 异步通知返回的参数（部分说明）</span></span><br><span class="line">         <span class="comment">// out_trade_no ：商户订单号，商户网站订单系统中唯一订单号</span></span><br><span class="line">         <span class="comment">// trade_no ：支付宝交易号，支付宝交易凭证号</span></span><br><span class="line">         <span class="comment">// app_id ：开发者的app_id</span></span><br><span class="line">         <span class="comment">// out_biz_no ：商户业务号</span></span><br><span class="line">         <span class="comment">// buyer_id ：买家支付宝用户号，买家支付宝账号对应的支付宝唯一用户号，以 2088 开头的纯 16 位数字</span></span><br><span class="line">         <span class="comment">// seller_id ：卖家支付宝用户号 卖家支付宝用户号</span></span><br><span class="line">         <span class="comment">// trade_status ：交易状态</span></span><br><span class="line">         <span class="comment">// total_amount ：订单金额</span></span><br><span class="line">         <span class="comment">// receipt_amount ：实收金额</span></span><br><span class="line">         <span class="comment">// invoice_amount ：开票金额</span></span><br><span class="line">         <span class="comment">// buyer_pay_amount ：付款金额</span></span><br><span class="line">         <span class="comment">// point_amount ：集分宝金额 使用集分宝支付的金额，单位为元，精确到小数点后2位</span></span><br><span class="line">         <span class="comment">// subject ：订单标题</span></span><br><span class="line">         <span class="comment">// body ：商品描述</span></span><br><span class="line">         <span class="comment">// fund_bill_list ：支付金额信息</span></span><br><span class="line">         <span class="comment">// passback_params  回传参数</span></span><br><span class="line">         System.out.println(<span class="string">"********************** 支付宝异步通知成功   **********************"</span>);</span><br><span class="line">         System.out.println(<span class="string">"异步通知返回参数："</span> + params.toString());</span><br><span class="line">         System.out.println(<span class="string">"********************** 支付宝异步通知成功   **********************"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (params.get(<span class="string">"trade_status"</span>).equals(<span class="string">"TRADE_FINISHED"</span>))&#123;</span><br><span class="line"></span><br><span class="line">             <span class="comment">// 注意： 注意这里用于退款功能的实现</span></span><br><span class="line">             System.out.println(<span class="string">"执行退款相关业务"</span>);</span><br><span class="line">         &#125;<span class="keyword">else</span> <span class="keyword">if</span> (params.get(<span class="string">"trade_status"</span>).equals(<span class="string">"TRADE_SUCCESS"</span>)) &#123;</span><br><span class="line"></span><br><span class="line">             <span class="comment">// 1. 根据out_trade_no 查询订单</span></span><br><span class="line">             <span class="comment">// 2. 判断total_amount 是否正确，即是否为商户订单创建时的金额</span></span><br><span class="line">             <span class="comment">// 3. 校验通知中的seller_id（或者seller_email) 是否为out_trade_no这笔单据的对应的操作方（有的时候，一个商户可能有多个seller_id/seller_email）</span></span><br><span class="line">             <span class="comment">// 4. 验证app_id是否为该商户本身</span></span><br><span class="line">             <span class="comment">// 5. 判断该笔订单是否在商户网站中已经做过处理</span></span><br><span class="line">             <span class="comment">// 6. 如果没有做过处理，根据订单号（out_trade_no）在商户网站的订单系统中查到该笔订单的详细，并执行商户的业务程序，修改订单状态</span></span><br><span class="line">             <span class="comment">// 7. 如果有做过处理，不执行商户的业务程序</span></span><br><span class="line">             System.out.println(<span class="string">"执行相关业务"</span>);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         System.out.println(<span class="string">"支付, 验签失败..."</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="6-订单查询代码"><a href="#6-订单查询代码" class="headerlink" title="6 订单查询代码"></a>6 订单查询代码</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 订单查询</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> out_trade_no 商户订单号，商户网站订单系统中唯一订单号</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> trade_no 支付宝交易号 注意： out_trade_no 和  trade_no 二选一即可</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> result</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="meta">@RequestMapping</span>(value = <span class="string">"/ali/pay/order/query"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">(String out_trade_no,String trade_no)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">     System.out.println(<span class="string">"订单查询..."</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//获得初始化的AlipayClient</span></span><br><span class="line">     AlipayClient alipayClient = <span class="keyword">new</span> DefaultAlipayClient(MyAliPayConfig.gatewayUrl, MyAliPayConfig.app_id, MyAliPayConfig.merchant_private_key, <span class="string">"json"</span>, MyAliPayConfig.charset, MyAliPayConfig.alipay_public_key, MyAliPayConfig.sign_type);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//设置请求参数</span></span><br><span class="line">     AlipayTradeQueryRequest alipayRequest = <span class="keyword">new</span> AlipayTradeQueryRequest();</span><br><span class="line"></span><br><span class="line">     <span class="comment">// out_trade_no 和 trade_no 设置二选一即可</span></span><br><span class="line">     alipayRequest.setBizContent(<span class="string">"&#123;\"out_trade_no\":\""</span>+ out_trade_no +<span class="string">"\","</span>+<span class="string">"\"trade_no\":\""</span>+ trade_no +<span class="string">"\"&#125;"</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//请求</span></span><br><span class="line">     String result = <span class="keyword">null</span>;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         result = alipayClient.execute(alipayRequest).getBody();</span><br><span class="line">     &#125; <span class="keyword">catch</span> (AlipayApiException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//输出</span></span><br><span class="line">     System.out.println(<span class="string">"订单查询结果："</span> +result);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span>  result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="8-退款代码代码"><a href="#8-退款代码代码" class="headerlink" title="8 退款代码代码"></a>8 退款代码代码</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 退款</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> out_trade_no 商户订单号，商户网站订单系统中唯一订单号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> trade_no 支付宝交易号 注意： out_trade_no 和  trade_no 二选一即可</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> refund_amount 需要退款的金额，该金额不能大于订单金额，必填</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> refund_reason 退款的原因说明</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> out_request_no 标识一次退款请求，同一笔交易多次退款需要保证唯一，如需部分退款，则此参数必传</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> result</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ali/refund/order/create"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">refund</span><span class="params">(String out_trade_no,String trade_no,String refund_amount, String refund_reason, String out_request_no)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"退款..."</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获得初始化的AlipayClient</span></span><br><span class="line">    AlipayClient alipayClient = <span class="keyword">new</span> DefaultAlipayClient(MyAliPayConfig.gatewayUrl, MyAliPayConfig.app_id, MyAliPayConfig.merchant_private_key, <span class="string">"json"</span>, MyAliPayConfig.charset, MyAliPayConfig.alipay_public_key, MyAliPayConfig.sign_type);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置请求参数</span></span><br><span class="line">    AlipayTradeRefundRequest alipayRequest = <span class="keyword">new</span> AlipayTradeRefundRequest();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    alipayRequest.setBizContent(<span class="string">"&#123;\"out_trade_no\":\""</span>+ out_trade_no +<span class="string">"\","</span></span><br><span class="line">            + <span class="string">"\"trade_no\":\""</span>+ trade_no +<span class="string">"\","</span></span><br><span class="line">            + <span class="string">"\"refund_amount\":\""</span>+ refund_amount +<span class="string">"\","</span></span><br><span class="line">            + <span class="string">"\"refund_reason\":\""</span>+ refund_reason +<span class="string">"\","</span></span><br><span class="line">            + <span class="string">"\"out_request_no\":\""</span>+ out_request_no +<span class="string">"\"&#125;"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//请求</span></span><br><span class="line">    String result = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        result = alipayClient.execute(alipayRequest).getBody();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (AlipayApiException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//输出</span></span><br><span class="line">    System.out.println(<span class="string">"退款结果:"</span> + result);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="9-退款查询代码"><a href="#9-退款查询代码" class="headerlink" title="9 退款查询代码"></a>9 退款查询代码</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 退款查询</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> out_trade_no  商户订单号，商户网站订单系统中唯一订单号</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> trade_no 支付宝交易号， 注意： out_trade_no 和  trade_no 二选一即可</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> out_request_no 请求退款接口时，传入的退款请求号，如果在退款请求时未传入，则该值为创建交易时的外部交易号，必填</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> result</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="meta">@RequestMapping</span>(value = <span class="string">"/ali/refund/order/query"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">refundQuery</span><span class="params">(String out_trade_no, String trade_no, String out_request_no)</span></span>&#123;</span><br><span class="line">     System.out.println(<span class="string">"退款查询......"</span>);</span><br><span class="line">     <span class="comment">//获得初始化的AlipayClient</span></span><br><span class="line">     AlipayClient alipayClient = <span class="keyword">new</span> DefaultAlipayClient(MyAliPayConfig.gatewayUrl, MyAliPayConfig.app_id, MyAliPayConfig.merchant_private_key, <span class="string">"json"</span>, MyAliPayConfig.charset, MyAliPayConfig.alipay_public_key, MyAliPayConfig.sign_type);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//设置请求参数</span></span><br><span class="line">     AlipayTradeFastpayRefundQueryRequest alipayRequest = <span class="keyword">new</span> AlipayTradeFastpayRefundQueryRequest();</span><br><span class="line">     alipayRequest.setBizContent(<span class="string">"&#123;\"out_trade_no\":\""</span>+ out_trade_no +<span class="string">"\","</span></span><br><span class="line">             +<span class="string">"\"trade_no\":\""</span>+ trade_no +<span class="string">"\","</span></span><br><span class="line">             +<span class="string">"\"out_request_no\":\""</span>+ out_request_no +<span class="string">"\"&#125;"</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//请求</span></span><br><span class="line">     String result = <span class="keyword">null</span>;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         result = alipayClient.execute(alipayRequest).getBody();</span><br><span class="line">     &#125; <span class="keyword">catch</span> (AlipayApiException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//输出</span></span><br><span class="line">     System.out.println(<span class="string">"退款查询结果："</span>+result);;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="10-订单关闭代码"><a href="#10-订单关闭代码" class="headerlink" title="10 订单关闭代码"></a>10 订单关闭代码</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 交易关闭</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> out_trade_no  商户订单号，商户网站订单系统中唯一订单号</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> trade_no 支付宝交易号， 注意： out_trade_no 和  trade_no 二选一即可</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> result</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@ResponseBody</span></span><br><span class="line"> <span class="meta">@RequestMapping</span>(value = <span class="string">"/ali/order/close"</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">close</span><span class="params">(String out_trade_no, String trade_no)</span></span>&#123;</span><br><span class="line">     System.out.println(<span class="string">"交易关闭....."</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//获得初始化的AlipayClient</span></span><br><span class="line">     AlipayClient alipayClient = <span class="keyword">new</span> DefaultAlipayClient(MyAliPayConfig.gatewayUrl, MyAliPayConfig.app_id, MyAliPayConfig.merchant_private_key, <span class="string">"json"</span>, MyAliPayConfig.charset, MyAliPayConfig.alipay_public_key, MyAliPayConfig.sign_type);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">//设置请求参数</span></span><br><span class="line">     AlipayTradeCloseRequest alipayRequest = <span class="keyword">new</span> AlipayTradeCloseRequest();</span><br><span class="line">     alipayRequest.setBizContent(<span class="string">"&#123;\"out_trade_no\":\""</span>+ out_trade_no +<span class="string">"\","</span> +<span class="string">"\"trade_no\":\""</span>+ trade_no +<span class="string">"\"&#125;"</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//请求</span></span><br><span class="line">     String result = <span class="keyword">null</span>;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         result = alipayClient.execute(alipayRequest).getBody();</span><br><span class="line">     &#125; <span class="keyword">catch</span> (AlipayApiException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//输出</span></span><br><span class="line">     System.out.println(<span class="string">"交易关闭结果："</span>+result);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div>





<h2 id="11-完整的代码地址"><a href="#11-完整的代码地址" class="headerlink" title="11 完整的代码地址"></a>11 完整的代码地址</h2><p>代码地址：<a href="https://github.com/foochane/aw-pay" target="_blank" rel="noopener">https://github.com/foochane/aw-pay</a></p>
<p>这个代码只是简单的写controller层的代码，只是为了快速体验一下支付宝的接口调用，后期将进行具体的完善。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">foochane</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://foochane.cn/article/2020032001.html">https://foochane.cn/article/2020032001.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://foochane.cn">foochane</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java    </a></div><div class="post_share"><div class="social-share" data-image="/images/cover/11.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/images/site/reward/wechat.png" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/images/site/reward/alipay.png" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/article/2020032501.html"><img class="prev_cover lazyload" data-src="/images/cover/14.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>SpringBoot接入微信支付</span></div></a></div><div class="next-post pull_right"><a href="/article/2020011301.html"><img class="next_cover lazyload" data-src="/images/cover/0.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Java学习笔记（十四）：MySQL数据库</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019122001.html" title="Java学习笔记（二）：常用API总结"><img class="relatedPosts_cover lazyload"data-src="/images/cover/12.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-12-20</div><div class="relatedPosts_title">Java学习笔记（二）：常用API总结</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019123001.html" title="Java学习笔记（四）：异常处理"><img class="relatedPosts_cover lazyload"data-src="/images/cover/10.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-12-30</div><div class="relatedPosts_title">Java学习笔记（四）：异常处理</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019123101.html" title="Java学习笔记（六）：Lambda表达式"><img class="relatedPosts_cover lazyload"data-src="/images/cover/8.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-12-31</div><div class="relatedPosts_title">Java学习笔记（六）：Lambda表达式</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2019123002.html" title="Java学习笔记（五）：线程"><img class="relatedPosts_cover lazyload"data-src="/images/cover/9.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-12-30</div><div class="relatedPosts_title">Java学习笔记（五）：线程</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2020010201.html" title="Java学习笔记（八）：缓冲流、转换流和序列化流"><img class="relatedPosts_cover lazyload"data-src="/images/cover/6.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-02</div><div class="relatedPosts_title">Java学习笔记（八）：缓冲流、转换流和序列化流</div></div></a></div><div class="relatedPosts_item"><a href="https://foochane.cn/article/2020010401.html" title="Java学习笔记（九）：网络编程"><img class="relatedPosts_cover lazyload"data-src="/images/cover/5.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-04</div><div class="relatedPosts_title">Java学习笔记（九）：网络编程</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = true == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'zCeKCftRr91sIth6b8UsWKb9-gzGzoHsz',
  appKey:'SIMyV1MuzsbUpvUErd6bUlC2',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" style="background-image: url(/images/banner/0.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By foochane</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>